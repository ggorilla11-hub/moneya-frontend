// src/pages/MyPage.tsx
// v2.8.1: ê¸ˆìœµê°ë…ì› ì „ë¬¸ê°€ ê°•ì˜ì˜ìƒ ë©”ë‰´ ë³µì› (ë”ë³´ê¸° íƒ­)
// v2.8.0: PIN ì ê¸ˆ ì„¤ì • ë©”ë‰´ ì¶”ê°€ (ì•± ì ê¸ˆ ì„¤ì • / PIN ë³€ê²½ / PIN í•´ì œ)
// v2.7.0: ì„¤ì • í™”ë©´ êµ¬í˜„ - ì•Œë¦¼, í™”ë©´, ë³´ì•ˆ, ë°ì´í„°ê´€ë¦¬, ì•±ì •ë³´ (localStorage ì—°ë™)
// v2.6.5: ì§‘ ì¼ëŸ¬ìŠ¤íŠ¸ ë¶€ìì§€ìˆ˜ ì—°ë™ ìˆ˜ì • - financialResult.wealthIndex ìš°ì„ , localStorage fallback
// v2.6.4: í”„ë¡œí•„ ì˜ì—­ ì‹¤ë°ì´í„° ì—°ë™ - ì§‘ ì¼ëŸ¬ìŠ¤íŠ¸(ë¶€ìì§€ìˆ˜ 5ë‹¨ê³„) + DESIRE ì§„í–‰ë°”(ê¸ˆìœµì§‘ì§“ê¸° 1ë‹¨ê³„ STEP5 ê²°ê³¼)
// v2.6.3: í”„ë¡œí•„ ì˜ì—­ ì¼ëŸ¬ìŠ¤íŠ¸ ì§‘ + DESIRE 6ë‹¨ê³„ ì§„í–‰ë°” ë³µì›
// v2.6.2: ì „ìì±… ëª¨ë‹¬ ë³µì›
// v2.6.1: ì˜¨ë¼ì¸ê°•ì¢Œ 107ê°• ëª¨ë‹¬ UI ë³µì› (v2.2 ìŠ¤íƒ€ì¼)
// - v2.2: ì˜¨ë¼ì¸ê°•ì¢Œ í˜ì´ì§€ ì—°ê²°
// - v2.3: ê³µìœ  URL, DESIRE ë¡œë“œë§µ (ì‹¤ì œ financialHouseData ì—°ë™)
// - v2.4: ë©¤ë²„ì‹­ í”Œëœ (ì¼ë°˜ì¸/FP íƒ­, ì›”ê°„/ì—°ê°„ ì„ íƒ, ì¹´ë“œê²°ì œ UI)
// - v2.5: mailto encodeURIComponent ìˆ˜ì •, ì „ì²´ í†µí•©
// - v2.6: DESIRE ë¡œë“œë§µ â†’ ì›ë³¸ ê¸°íšëŒ€ë¡œ ì¬êµ¬í˜„
// - v2.6.1: ì˜¨ë¼ì¸ê°•ì¢Œ 107ê°• ëª¨ë‹¬ â†’ v2.2 ìŠ¤íƒ€ì¼ ë³µì›
//         (cyan/teal ê·¸ë¼ë°ì´ì…˜ ì†Œê°œ ì¹´ë“œ + ê°€ê²© ë²„íŠ¼ 3ê°œ)

import { useState, useEffect, useRef } from 'react';
// â˜…â˜…â˜… v2.8.0 ì¶”ê°€: PIN ì„¤ì • í™”ë©´ â˜…â˜…â˜…
import PinSetupScreen from '../components/PinSetupScreen';

// â”€â”€â”€ ì´ë¯¸ì§€ URL ìƒìˆ˜ â”€â”€â”€
const LOGO_URL = "https://firebasestorage.googleapis.com/v0/b/moneya-72fe6.firebasestorage.app/o/AI%EB%A8%B8%EB%8B%88%EC%95%BC%20%ED%99%95%EC%A0%95%EC%9D%B4%EB%AF%B8%EC%A7%80%EC%95%88.png?alt=media&token=c250863d-7cda-424a-800d-884b20e30b1a";
const PROFILE_IMAGE_URL = 'https://firebasestorage.googleapis.com/v0/b/moneya-72fe6.firebasestorage.app/o/%EC%98%A4%EC%83%81%EC%97%B4%20%EC%82%AC%EC%A7%84.png?alt=media&token=63eaf15e-9d0b-4d72-8fbb-ee03d6ecc8e5';
const EBOOK_COVER_URL = 'https://firebasestorage.googleapis.com/v0/b/moneya-72fe6.firebasestorage.app/o/financial-house-exterior.png.png?alt=media&token=e1651823-af8e-4ed3-9b3d-557a1bf0eb10';
const SHARE_URL = 'https://moneya-frontend.vercel.app';

// â”€â”€â”€ íƒ€ì… ì •ì˜ â”€â”€â”€
interface FinancialResult { name: string; age: number; income: number; assets: number; debt: number; wealthIndex: number; level: number; houseName: string; houseImage: string; message: string; }
interface MembershipPlanItem { tier: string; price: number; priceDisplay: string; annual: number; annualDisplay: string; annualMonthly: string; badge: string; gradient: string; benefits: string[]; highlight: boolean; current: boolean; }

// â”€â”€â”€ DESIRE 6ë‹¨ê³„ ì •ì˜ â”€â”€â”€
const DESIRE_STAGES = [
  { stage: 1, letter: 'D', name: 'Debt Free', title: 'ì‹ ìš©ëŒ€ì¶œ ìƒí™˜', house: 'ğŸšï¸', houseName: 'ì´ˆê°€ì§‘', color: '#dc2626', bgFrom: '#fee2e2', bgTo: '#fecaca', certGuide: 'ì‹ ìš©ëŒ€ì¶œ ìƒí™˜ ì™„ë£Œ ì¸ì¦ìƒ·ì„ ì²¨ë¶€í•˜ì„¸ìš”', dataSource: 'ê¸ˆìœµì§‘ì§“ê¸° > ë¶€ì±„ì„¤ê³„ > ì‹ ìš©ëŒ€ì¶œ' },
  { stage: 2, letter: 'E', name: 'Emergency Fund', title: 'ë¹„ìƒì˜ˆë¹„ìê¸ˆ í™•ë³´', house: 'ğŸ¡', houseName: 'ë‚˜ë¬´ì§‘', color: '#ea580c', bgFrom: '#ffedd5', bgTo: '#fed7aa', certGuide: 'ë¹„ìƒì˜ˆë¹„ìê¸ˆ ë§ˆë ¨ ê¸ˆì•¡ì„ ì¸ì¦í•˜ì„¸ìš”', dataSource: 'ê¸ˆìœµì§‘ì§“ê¸° > íˆ¬ìì„¤ê³„ > ë¹„ìƒì˜ˆë¹„ìê¸ˆ' },
  { stage: 3, letter: 'S', name: 'Savings', title: 'ì €ì¶•Â·ì—°ê¸ˆ ìë™í™”', house: 'ğŸ ', houseName: 'ë²½ëŒì§‘', color: '#ca8a04', bgFrom: '#fef9c3', bgTo: '#fef08a', certGuide: 'ì €ì¶•/íˆ¬ì í˜„í™© ì¸ì¦ìƒ·ì„ ì²¨ë¶€í•˜ì„¸ìš”', dataSource: 'ê¸ˆìœµì§‘ì§“ê¸° > ì˜ˆì‚°ì„¤ê³„ > ì €ì¶•/ì—°ê¸ˆ' },
  { stage: 4, letter: 'I', name: 'Investment', title: 'ê¸ˆìœµìì‚° 10ì–µ', house: 'ğŸ¢', houseName: 'ì½˜í¬ë¦¬íŠ¸', color: '#2563eb', bgFrom: '#dbeafe', bgTo: '#bfdbfe', certGuide: 'ê¸ˆìœµìì‚° 10ì–µì› ë‹¬ì„± ì¸ì¦ìƒ·ì„ ì²¨ë¶€í•˜ì„¸ìš”', dataSource: 'ê¸ˆìœµì§‘ì§“ê¸° > íˆ¬ìì„¤ê³„ > ê¸ˆìœµìì‚°' },
  { stage: 5, letter: 'R', name: 'Retirement', title: 'ë‹´ë³´ëŒ€ì¶œ ìƒí™˜', house: 'ğŸ›ï¸', houseName: 'ëŒ€ë¦¬ì„', color: '#7c3aed', bgFrom: '#ede9fe', bgTo: '#ddd6fe', certGuide: 'ë‹´ë³´ëŒ€ì¶œ ìƒí™˜ ì™„ë£Œ ì¸ì¦ìƒ·ì„ ì²¨ë¶€í•˜ì„¸ìš”', dataSource: 'ê¸ˆìœµì§‘ì§“ê¸° > ë¶€ì±„ì„¤ê³„ > ë‹´ë³´ëŒ€ì¶œ' },
  { stage: 6, letter: 'E', name: 'Enjoy & Estate', title: 'ğŸ ì„ ë¬¼í•¨', house: 'ğŸ°', houseName: 'ê³ ê¸‰ì£¼íƒ', color: '#059669', bgFrom: '#d1fae5', bgTo: '#a7f3d0', certGuide: '', dataSource: '' },
];

interface LoanItem { id: number; name: string; amount: number; rate: number; }
interface DesireStageDetail { summary: string; creditLoans?: LoanItem[]; mortgageLoans?: LoanItem[]; emergencyFund?: { current: number; target: number; secured: boolean }; savings?: { monthlySaving: number; monthlyPension: number; irregularIncome: number; budgetTotal: number }; investment?: { financialAssets: number; target: number }; }

const FAQ_DATA = [
  { q: 'ê¸ˆìœµì§‘ì§“ê¸°Â®ë€ ë¬´ì—‡ì¸ê°€ìš”?', a: 'ì˜¤ì›íŠ¸ê¸ˆìœµì—°êµ¬ì†Œì—ì„œ ê°œë°œí•œ ì¬ë¬´ì„¤ê³„ ë°©ë²•ë¡ ìœ¼ë¡œ, ì§‘ì„ ì§“ë“¯ì´ ì²´ê³„ì ìœ¼ë¡œ ê¸ˆìœµ ê³„íšì„ ì„¸ìš°ëŠ” í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤.' },
  { q: 'ìœ ë£Œ êµ¬ë… ìš”ê¸ˆì€ ì–¼ë§ˆì¸ê°€ìš”?', a: 'ì¼ë°˜ì¸ìš©: ë² ì´ì§ 12,900ì›, ìŠ¤íƒ ë‹¤ë“œ 29,000ì›, í”„ë¦¬ë¯¸ì—„ 59,000ì› / FPìš©: ë² ì´ì§ 33,000ì›, ìŠ¤íƒ ë‹¤ë“œ 59,000ì›, í”„ë¦¬ë¯¸ì—„ 99,000ì›ì…ë‹ˆë‹¤.' },
  { q: 'AI ì§€ì¶œ ìƒë‹´ì€ ì–´ë–»ê²Œ ì´ìš©í•˜ë‚˜ìš”?', a: 'AIì§€ì¶œ íƒ­ì—ì„œ ìŒì„± ë˜ëŠ” í…ìŠ¤íŠ¸ë¡œ ì§€ì¶œì— ëŒ€í•´ ìƒë‹´ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.' },
  { q: 'ì¬ë¬´ì„¤ê³„ ë¦¬í¬íŠ¸ëŠ” ì–´ë””ì„œ ë³¼ ìˆ˜ ìˆë‚˜ìš”?', a: 'ë”ë³´ê¸° > ì›”ê°„ ë¦¬í¬íŠ¸ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.' },
  { q: 'ì „ë¬¸ê°€ ìƒë‹´ì€ ì–´ë–»ê²Œ ì‹ ì²­í•˜ë‚˜ìš”?', a: 'ë”ë³´ê¸° > ì˜¤ìƒì—´ ëŒ€í‘œ ê°•ì˜Â·ìƒë‹´ ì‹ ì²­ì—ì„œ ì›í•˜ì‹œëŠ” ìƒë‹´ ìœ í˜•ì„ ì„ íƒí•˜ì—¬ ì‹ ì²­í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.' },
  { q: 'ê°œì¸ì •ë³´ëŠ” ì•ˆì „í•˜ê²Œ ë³´í˜¸ë˜ë‚˜ìš”?', a: 'ë„¤, ëª¨ë“  ê°œì¸ì •ë³´ëŠ” ì•”í˜¸í™”ë˜ì–´ ì•ˆì „í•˜ê²Œ ë³´ê´€ë©ë‹ˆë‹¤.' },
  { q: 'íšŒì› íƒˆí‡´ëŠ” ì–´ë–»ê²Œ í•˜ë‚˜ìš”?', a: 'ë”ë³´ê¸° > íšŒì›íƒˆí‡´ì—ì„œ íƒˆí‡´ ì‹ ì²­í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. íƒˆí‡´ ì‹œ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.' },
];

const MEMBERSHIP_PLANS: Record<string, MembershipPlanItem[]> = {
  general: [
    { tier: 'FREE', price: 0, priceDisplay: 'ë¬´ë£Œ', annual: 0, annualDisplay: '0', annualMonthly: '0', badge: 'ğŸ†“', gradient: 'from-gray-400 to-gray-500', benefits: ['AIë¨¸ë‹ˆì•¼ ì „ì²´ ê¸°ëŠ¥ ì²´í—˜', '7ì¼ê°„ í”„ë¦¬ë¯¸ì—„ê¸‰ ì´ìš©'], highlight: false, current: true },
    { tier: 'BASIC', price: 12900, priceDisplay: '12,900', annual: 129000, annualDisplay: '129,000', annualMonthly: '10,750', badge: 'ğŸ¥‰', gradient: 'from-blue-500 to-blue-600', benefits: ['AIë¨¸ë‹ˆì•¼ ì „ì²´ ê¸°ëŠ¥', 'ê¸ˆìœµì§‘ì§“ê¸°Â® ì „ìì±… ì œê³µ', '(12,900ì› ìƒë‹¹)'], highlight: false, current: false },
    { tier: 'STANDARD', price: 29000, priceDisplay: '29,000', annual: 290000, annualDisplay: '290,000', annualMonthly: '24,167', badge: 'ğŸ¥ˆ', gradient: 'from-purple-500 to-indigo-600', benefits: ['BASIC ì „ì²´ í¬í•¨', 'ì˜¨ë¼ì¸ê°•ì¢Œ 107ê°• ë¬´ì œí•œ', 'ì „ìì±… + ê°•ì¢Œ ì˜¬ì¸ì›'], highlight: true, current: false },
    { tier: 'PREMIUM', price: 59000, priceDisplay: '59,000', annual: 590000, annualDisplay: '590,000', annualMonthly: '49,167', badge: 'ğŸ¥‡', gradient: 'from-amber-500 to-amber-600', benefits: ['STANDARD ì „ì²´ í¬í•¨', 'ì›”ë¡€ ZOOM ì„¸ë¯¸ë‚˜ ì°¸ì„', 'ì˜¤ìƒì—´ CFP ì§ì ‘ ê°•ì˜'], highlight: false, current: false },
  ],
  fp: [
    { tier: 'FREE', price: 0, priceDisplay: 'ë¬´ë£Œ', annual: 0, annualDisplay: '0', annualMonthly: '0', badge: 'ğŸ†“', gradient: 'from-gray-400 to-gray-500', benefits: ['AIë¨¸ë‹ˆì•¼ ì „ì²´ ê¸°ëŠ¥ ì²´í—˜', '7ì¼ê°„ í”„ë¦¬ë¯¸ì—„ê¸‰ ì´ìš©'], highlight: false, current: true },
    { tier: 'BASIC', price: 33000, priceDisplay: '33,000', annual: 330000, annualDisplay: '330,000', annualMonthly: '27,500', badge: 'ğŸ¥‰', gradient: 'from-blue-500 to-blue-600', benefits: ['ì¼ë°˜ì¸ STANDARD ì „ì²´ í¬í•¨', 'ê³ ê° 100ëª… ë“±ë¡ ê´€ë¦¬', 'ì „ìì±… + ì˜¨ë¼ì¸ê°•ì¢Œ 107ê°•'], highlight: false, current: false },
    { tier: 'STANDARD', price: 59000, priceDisplay: '59,000', annual: 590000, annualDisplay: '590,000', annualMonthly: '49,167', badge: 'ğŸ¥ˆ', gradient: 'from-purple-500 to-indigo-600', benefits: ['ì¼ë°˜ì¸ PREMIUM ì „ì²´ í¬í•¨', 'ê³ ê° 500ëª… ë“±ë¡ ê´€ë¦¬', 'ì›”ë¡€ ZOOM ì„¸ë¯¸ë‚˜ í¬í•¨'], highlight: true, current: false },
    { tier: 'PREMIUM', price: 99000, priceDisplay: '99,000', annual: 990000, annualDisplay: '990,000', annualMonthly: '82,500', badge: 'ğŸ¥‡', gradient: 'from-amber-500 to-amber-600', benefits: ['ì¼ë°˜ì¸ PREMIUM ì „ì²´ í¬í•¨', 'ê³ ê° ë¬´ì œí•œ ë“±ë¡ ê´€ë¦¬', 'ì›”ë¡€ ZOOM ì„¸ë¯¸ë‚˜ í¬í•¨'], highlight: false, current: false },
  ],
};

const formatCardNumber = (v: string): string => { const nums = v.replace(/\D/g, '').slice(0, 16); return nums.replace(/(\d{4})(?=\d)/g, '$1-'); };
const formatExpiry = (v: string): string => { const nums = v.replace(/\D/g, '').slice(0, 4); if (nums.length > 2) return nums.slice(0, 2) + '/' + nums.slice(2); return nums; };

interface MyPageProps { userName: string; userEmail: string; userPhoto: string | null; financialResult: FinancialResult | null; onNavigate: (page: 'subscription' | 'consulting' | 'monthly-report' | 'online-course' | 'podcast') => void; onLogout: () => void; onReset: () => void; userId?: string; }

export default function MyPage({ userName, userEmail, userPhoto: _userPhoto, financialResult: _financialResult, onNavigate, onLogout, onReset, userId }: MyPageProps) {
  const [showResetConfirm, setShowResetConfirm] = useState(false);
  const [showProfileEdit, setShowProfileEdit] = useState(false);
  const [showSettings, setShowSettings] = useState(false);
  const [settingNotification, setSettingNotification] = useState(() => localStorage.getItem('moneya_setting_notification') !== 'false');
  const [settingDailyReminder, setSettingDailyReminder] = useState(() => localStorage.getItem('moneya_setting_dailyReminder') !== 'false');
  const [settingSound, setSettingSound] = useState(() => localStorage.getItem('moneya_setting_sound') !== 'false');
  const [settingBioAuth, setSettingBioAuth] = useState(() => localStorage.getItem('moneya_setting_bioAuth') === 'true');
  const [settingAmountUnit, setSettingAmountUnit] = useState<'ë§Œì›' | 'ì›'>(() => (localStorage.getItem('moneya_setting_amountUnit') as 'ë§Œì›' | 'ì›') || 'ë§Œì›');
  const [showCacheClearDone, setShowCacheClearDone] = useState(false);
  const [showFAQ, setShowFAQ] = useState(false);
  const [showTerms, setShowTerms] = useState(false);
  const [showPrivacy, setShowPrivacy] = useState(false);
  const [showWithdraw, setShowWithdraw] = useState(false);
  const [showDesireRoadmap, setShowDesireRoadmap] = useState(false);
  const [showOnlineCourse, setShowOnlineCourse] = useState(false);
  const [showEbook, setShowEbook] = useState(false);
  const [showShare, setShowShare] = useState(false);
  const [showPinSetup, setShowPinSetup] = useState(false);
  const [pinMode, setPinMode] = useState<'setup' | 'change' | 'disable'>('setup');
  const pinEnabled = userId ? localStorage.getItem(`moneya_pin_enabled_${userId}`) === 'true' : false;
  const [pinEnabledState, setPinEnabledState] = useState(pinEnabled);
  const [showExpertConsult, setShowExpertConsult] = useState(false);
  const [consultView, setConsultView] = useState<'list' | 'schedule' | 'confirm'>('list');
  const [consultSelectedType, setConsultSelectedType] = useState<any>(null);
  const [consultSelectedMonth, setConsultSelectedMonth] = useState<number | null>(null);
  const [consultBookings, setConsultBookings] = useState<any[]>([]);
  const [consultToast, setConsultToast] = useState<string | null>(null);
  const [showMembership, setShowMembership] = useState(false);
  const [membershipTab, setMembershipTab] = useState<'general' | 'fp'>('general');
  const [membershipStep, setMembershipStep] = useState<'list' | 'cycle' | 'payment' | 'done'>('list');
  const [selectedMembershipPlan, setSelectedMembershipPlan] = useState<MembershipPlanItem | null>(null);
  const [billingCycle, setBillingCycle] = useState<'monthly' | 'annual' | null>(null);
  const [cardNumber, setCardNumber] = useState('');
  const [cardExpiry, setCardExpiry] = useState('');
  const [cardCvc, setCardCvc] = useState('');
  const [cardHolder, setCardHolder] = useState('');
  const [isPayProcessing, setIsPayProcessing] = useState(false);
  const [editName, setEditName] = useState(userName);
  const [openFaqIndex, setOpenFaqIndex] = useState<number | null>(null);
  const [desireExpandedStage, setDesireExpandedStage] = useState<number | null>(null);
  const [desireStageDetails, setDesireStageDetails] = useState<Record<number, DesireStageDetail>>({});
  const [desireCompleted, setDesireCompleted] = useState<Record<number, boolean>>({});
  const [desireLoanChecks, setDesireLoanChecks] = useState<Record<string, boolean>>({});
  const [desirePhotos, setDesirePhotos] = useState<Record<number, string>>({});
  const [showCelebration, setShowCelebration] = useState(false);
  const [giftOpened, setGiftOpened] = useState(false);
  const photoInputRef = useRef<HTMLInputElement>(null);
  const [activePhotoStage, setActivePhotoStage] = useState<number | null>(null);
  const [showStoryForm, setShowStoryForm] = useState(false);
  const [storyNickname, setStoryNickname] = useState('');
  const [storyDesireStage, setStoryDesireStage] = useState('D');
  const [storyContent, setStoryContent] = useState('');
  const [storyContact, setStoryContact] = useState('');
  const [storyAgree, setStoryAgree] = useState(true);
  const [storySubmitted, setStorySubmitted] = useState(false);

  useEffect(() => {
    const details: Record<number, DesireStageDetail> = {};
    try {
      const raw = localStorage.getItem('financialHouseData');
      if (!raw) { for (let i = 1; i <= 6; i++) details[i] = { summary: 'ê¸ˆìœµì§‘ì§“ê¸°ì—ì„œ ë°ì´í„°ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”' }; setDesireStageDetails(details); return; }
      const data = JSON.parse(raw);
      const creditLoans: LoanItem[] = (data?.debtDesign?.creditLoans || []).map((l: any, idx: number) => ({ id: idx + 1, name: l.name || l.loanName || `ì‹ ìš©ëŒ€ì¶œ ${idx + 1}`, amount: Number(l.amount || l.loanAmount || 0), rate: Number(l.rate || l.interestRate || 0) })).sort((a: LoanItem, b: LoanItem) => b.rate - a.rate);
      const creditTotal = creditLoans.reduce((s, l) => s + l.amount, 0);
      details[1] = { summary: creditTotal > 0 ? `ì‹ ìš©ëŒ€ì¶œ ${creditLoans.length}ê±´ Â· ${(creditTotal / 10000).toLocaleString()}ë§Œì›` : 'ì‹ ìš©ëŒ€ì¶œ ì—†ìŒ âœ…', creditLoans };
      const ef = data?.investDesign?.emergencyFund || 0; const efTarget = data?.investDesign?.emergencyFundTarget || (data?.budgetDesign?.monthlyExpense || 0) * 6; const efSecured = ef >= efTarget && efTarget > 0;
      details[2] = { summary: ef > 0 ? `ë¹„ìƒì˜ˆë¹„ìê¸ˆ ${(ef / 10000).toLocaleString()}ë§Œì› í™•ë³´` : 'ë¹„ìƒì˜ˆë¹„ìê¸ˆ ë¯¸ì„¤ì •', emergencyFund: { current: ef, target: efTarget, secured: efSecured } };
      const monthlySaving = data?.budgetDesign?.monthlySavings || data?.budgetDesign?.monthlySaving || 0; const monthlyPension = data?.budgetDesign?.monthlyPension || 0; const irregularIncome = data?.budgetDesign?.irregularIncome || 0; const budgetTotal = data?.budgetDesign?.totalBudget || data?.budgetDesign?.monthlyIncome || 0;
      details[3] = { summary: (monthlySaving + monthlyPension) > 0 ? `ì›” ì €ì¶•+ì—°ê¸ˆ ${((monthlySaving + monthlyPension) / 10000).toLocaleString()}ë§Œì›` : 'ì €ì¶•/ì—°ê¸ˆ ë¯¸ì„¤ì •', savings: { monthlySaving, monthlyPension, irregularIncome, budgetTotal } };
      const fa = data?.investDesign?.financialAssets || 0; const target10 = 1000000000;
      details[4] = { summary: fa > 0 ? `ê¸ˆìœµìì‚° ${(fa / 100000000).toFixed(1)}ì–µì›` : 'ê¸ˆìœµìì‚° ë¯¸ì…ë ¥', investment: { financialAssets: fa, target: target10 } };
      const mortgageLoans: LoanItem[] = (data?.debtDesign?.mortgageLoans || []).map((l: any, idx: number) => ({ id: idx + 1, name: l.name || l.loanName || `ë‹´ë³´ëŒ€ì¶œ ${idx + 1}`, amount: Number(l.amount || l.loanAmount || 0), rate: Number(l.rate || l.interestRate || 0) })).sort((a: LoanItem, b: LoanItem) => b.rate - a.rate);
      const mortgageTotal = mortgageLoans.reduce((s, l) => s + l.amount, 0);
      details[5] = { summary: mortgageTotal > 0 ? `ë‹´ë³´ëŒ€ì¶œ ${mortgageLoans.length}ê±´ Â· ${(mortgageTotal / 10000).toLocaleString()}ë§Œì›` : 'ë‹´ë³´ëŒ€ì¶œ ì—†ìŒ âœ…', mortgageLoans };
      details[6] = { summary: '1~5ë‹¨ê³„ë¥¼ ëª¨ë‘ ì™„ë£Œí•˜ë©´ ì—´ë¦½ë‹ˆë‹¤' };
      setDesireStageDetails(details);
    } catch (e) { console.error('DESIRE ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e); }
    try { const sc = localStorage.getItem('desireCompleted'); if (sc) setDesireCompleted(JSON.parse(sc)); const lc = localStorage.getItem('desireLoanChecks'); if (lc) setDesireLoanChecks(JSON.parse(lc)); const ph = localStorage.getItem('desirePhotos'); if (ph) setDesirePhotos(JSON.parse(ph)); const go = localStorage.getItem('desireGiftOpened'); if (go) setGiftOpened(true); } catch { /* ignore */ }
  }, [showDesireRoadmap]);

  const handleDesireComplete = (stage: number) => { const next = { ...desireCompleted, [stage]: !desireCompleted[stage] }; setDesireCompleted(next); localStorage.setItem('desireCompleted', JSON.stringify(next)); };
  const handleLoanCheck = (key: string) => { const next = { ...desireLoanChecks, [key]: !desireLoanChecks[key] }; setDesireLoanChecks(next); localStorage.setItem('desireLoanChecks', JSON.stringify(next)); };
  const handlePhotoAttach = (stage: number) => { setActivePhotoStage(stage); photoInputRef.current?.click(); };
  const handlePhotoChange = (e: React.ChangeEvent<HTMLInputElement>) => { const file = e.target.files?.[0]; if (!file || activePhotoStage === null) return; const reader = new FileReader(); reader.onload = (ev) => { const url = ev.target?.result as string; const next = { ...desirePhotos, [activePhotoStage]: url }; setDesirePhotos(next); localStorage.setItem('desirePhotos', JSON.stringify(next)); }; reader.readAsDataURL(file); e.target.value = ''; };
  const handleOpenGift = () => { setGiftOpened(true); setShowCelebration(true); localStorage.setItem('desireGiftOpened', 'true'); };
  const isStageComplete = (stage: number): boolean => { if (stage === 6) return [1, 2, 3, 4, 5].every(s => isStageComplete(s)); return !!desireCompleted[stage]; };
  const DESIRE_CHIP_OPTIONS = [ { key: 'D', label: 'ğŸ’³ D-ë¹šê°šê¸°' }, { key: 'E1', label: 'ğŸ›¡ï¸ E-ë¹„ìƒê¸ˆ' }, { key: 'S', label: 'ğŸ’° S-ì €ì¶•' }, { key: 'I', label: 'ğŸ“ˆ I-íˆ¬ì' }, { key: 'R', label: 'ğŸ  R-ë¶€ë™ì‚°' }, { key: 'E2', label: 'ğŸ–ï¸ E-ì€í‡´' } ];
  const handleStorySubmit = () => { if (!storyNickname.trim() || storyContent.trim().length < 50 || !storyAgree) { alert(!storyNickname.trim() ? 'ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.' : storyContent.trim().length < 50 ? 'ì‚¬ì—°ì„ 50ì ì´ìƒ ì‘ì„±í•´ì£¼ì„¸ìš”.' : 'ê°œì¸ì •ë³´ ë™ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.'); return; } const mailto = `mailto:ggorilla11@gmail.com?subject=${encodeURIComponent(`[AIë¨¸ë‹ˆì•¼] DESIRE ì‚¬ë¡€ ì‹ ì²­ - ${storyNickname}`)}&body=${encodeURIComponent(`ë‹‰ë„¤ì„: ${storyNickname}\nDESIRE ë‹¨ê³„: ${storyDesireStage}\n\nì‚¬ì—°:\n${storyContent}\n\nì—°ë½ì²˜: ${storyContact || 'ë¯¸ì…ë ¥'}`)}`; window.location.href = mailto; setStorySubmitted(true); };
  const resetStoryForm = () => { setStoryNickname(''); setStoryDesireStage('D'); setStoryContent(''); setStoryContact(''); setStoryAgree(true); setStorySubmitted(false); setShowStoryForm(false); };
  const handleInquiry = () => { const to = 'ggorilla11@gmail.com'; const subject = encodeURIComponent('[AIë¨¸ë‹ˆì•¼] 1:1 ë¬¸ì˜'); const body = encodeURIComponent('ë¬¸ì˜ ë‚´ìš©ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.'); window.location.href = `mailto:${to}?subject=${subject}&body=${body}`; };
  const handleSelectPlan = (plan: MembershipPlanItem) => { if (plan.current) return; setSelectedMembershipPlan(plan); setBillingCycle(null); setMembershipStep('cycle'); };
  const handleSelectCycle = (cycle: 'monthly' | 'annual') => { setBillingCycle(cycle); setMembershipStep('payment'); setCardNumber(''); setCardExpiry(''); setCardCvc(''); setCardHolder(''); };
  const handlePay = () => { if (!cardNumber || !cardExpiry || !cardCvc || !cardHolder) { alert('ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; } setIsPayProcessing(true); setTimeout(() => { setIsPayProcessing(false); setMembershipStep('done'); }, 2000); };
  const closeMembership = () => { setShowMembership(false); setMembershipStep('list'); setSelectedMembershipPlan(null); setBillingCycle(null); };
  const shareText = `ğŸ’° AIë¨¸ë‹ˆì•¼ - AI ê¸°ë°˜ ì¬ë¬´ê´€ë¦¬ ì•±\nê¸ˆìœµì§‘ì§“ê¸°Â® ë°©ë²•ë¡ ìœ¼ë¡œ ì²´ê³„ì ì¸ ì¬ë¬´ì„¤ê³„ë¥¼ ì‹œì‘í•˜ì„¸ìš”!\n\nğŸ‘‰ ${SHARE_URL}`;
  const handleShare = async (method: string) => {
    if (method === 'copy') { try { await navigator.clipboard.writeText(SHARE_URL); alert('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'); } catch { alert(SHARE_URL); } }
    else if (method === 'kakao') { window.open(`https://sharer.kakao.com/talk/friends/picker/link?url=${encodeURIComponent(SHARE_URL)}&text=${encodeURIComponent(shareText)}`, '_blank', 'width=500,height=600'); }
    else if (method === 'sms') { window.location.href = `sms:?body=${encodeURIComponent(shareText)}`; }
    else if (method === 'email') { const subject = '[ì¶”ì²œ] AIë¨¸ë‹ˆì•¼ - AI ê¸°ë°˜ ì¬ë¬´ê´€ë¦¬ ì•±'; const body = `ì•ˆë…•í•˜ì„¸ìš”!\n\nAIë¨¸ë‹ˆì•¼ë¥¼ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.\nê¸ˆìœµì§‘ì§“ê¸°Â® ë°©ë²•ë¡ ìœ¼ë¡œ ì²´ê³„ì ì¸ ì¬ë¬´ì„¤ê³„ë¥¼ ì‹œì‘í•˜ì„¸ìš”!\n\nğŸ‘‰ ${SHARE_URL}\n\nQRì½”ë“œë¡œë„ ì ‘ì† ê°€ëŠ¥í•©ë‹ˆë‹¤.`; window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`; }
    else if (method === 'native') { if (navigator.share) { try { await navigator.share({ title: 'AIë¨¸ë‹ˆì•¼ - AI ê¸°ë°˜ ì¬ë¬´ê´€ë¦¬ ì•±', text: 'ê¸ˆìœµì§‘ì§“ê¸°Â® ë°©ë²•ë¡ ìœ¼ë¡œ ì²´ê³„ì ì¸ ì¬ë¬´ì„¤ê³„ë¥¼ ì‹œì‘í•˜ì„¸ìš”!', url: SHARE_URL }); } catch { /* cancel */ } } else { try { await navigator.clipboard.writeText(shareText); alert('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!'); } catch { alert(SHARE_URL); } } }
  };
  const handleResetClick = () => setShowResetConfirm(true);
  const handleResetConfirm = () => { setShowResetConfirm(false); onReset(); };
  const CONSULT_YEAR = 2026;
  const CONSULT_SCHEDULE: Record<string, { label: string; months: Record<number, number[]> }> = { expert: { label: 'ì „ë¬¸ê°€ ê°•ì˜', months: { 3: [7,14,21,28], 4: [4,11,18,25], 5: [2,9,16,23], 6: [6,13,20,27], 7: [4,11,18,25], 8: [1,8,22,29], 9: [5,12,19,26], 10: [10,17,24,31], 11: [7,14,21,28], 12: [5,12,19,26] } }, general: { label: 'ì¼ë°˜ì¸ ê°•ì˜', months: { 3: [9,16,23,30], 4: [6,13,20,27], 5: [4,11,18,25], 6: [8,15,22,29], 7: [6,13,20,27], 8: [3,10,24,31], 9: [7,14,21,28], 10: [12,19,26], 11: [9,16,23,30], 12: [7,14,21,28] } } };
  const PAYPLE_LINKS: Record<string, string> = { 'non-face': 'https://link.payple.kr/NzcxOjc2ODQ3NzYyNzY3MDU5', 'face': 'https://link.payple.kr/NzcxOjc2ODQ3NzU4NjYzMDE4', 'vip': 'https://link.payple.kr/NzcxOjc2OD', 'expert-lecture': 'https://link.payple.kr/NzcxOjc3MDA2MDc4OTM1OTgz', 'general-lecture': 'https://link.payple.kr/NzcxOjc2ODQ3NzcyMjc4MzY3' };
  const CONSULT_TYPES = [
    { id: 'general-lecture', icon: 'ğŸ“š', title: 'ì¼ë°˜ì¸ ê°•ì˜', desc: 'ëˆ„êµ¬ë‚˜ ë“¤ì„ ìˆ˜ ìˆëŠ” ì¬ë¬´ì„¤ê³„ ê¸°ì´ˆ ê°•ì˜', detail: 'ë¹„ëŒ€ë©´ Â· ì›” 4íšŒ Â· ì—°ê°„ ì¼ì •í‘œ ì œê³µ', price: 550000, priceLabel: '55ë§Œì›', sessions: 4, category: 'lecture' as const, scheduleType: 'general' },
    { id: 'expert-lecture', icon: 'ğŸ“', title: 'ì „ë¬¸ê°€ ê°•ì˜', desc: 'ë³´í—˜ì„¤ê³„ì‚¬Â·FP ëŒ€ìƒ ì‹¤ì „ ì¬ë¬´ì„¤ê³„ ê°•ì˜', detail: 'ëŒ€ë©´+ë¹„ëŒ€ë©´ Â· ì›” 4íšŒ Â· 1ë…„ ê³¼ì •', price: 1100000, priceLabel: '110ë§Œì›', priceSub: '1ë…„ ê³¼ì •', sessions: 4, category: 'lecture' as const, scheduleType: 'expert' },
    { id: 'non-face', icon: 'ğŸ’°', title: 'ë¹„ëŒ€ë©´ ìƒë‹´', desc: 'í™”ìƒìœ¼ë¡œ ì§„í–‰ë˜ëŠ” 1:1 ë§ì¶¤ ì¬ë¬´ìƒë‹´', detail: '2íšŒ ì§„í–‰ Â· ì¼ì • ë³„ë„ í˜‘ì˜', price: 330000, priceLabel: '33ë§Œì›', sessions: 2, category: 'consultation' as const },
    { id: 'face', icon: 'ğŸ’µ', title: 'ëŒ€ë©´ ìƒë‹´', desc: 'ì§ì ‘ ë§Œë‚˜ì„œ ì§„í–‰í•˜ëŠ” ì‹¬ì¸µ ì¬ë¬´ìƒë‹´', detail: '2íšŒ ì§„í–‰ Â· ì¼ì • ë³„ë„ í˜‘ì˜', price: 550000, priceLabel: '55ë§Œì›', sessions: 2, category: 'consultation' as const },
    { id: 'vip', icon: 'ğŸ“ˆ', title: 'ìì‚°ê°€ ìƒë‹´', desc: 'ê¸ˆìœµìì‚° 10ì–µì› ì´ˆê³¼ ê³ ê° ì „ìš© VIP ìƒë‹´', detail: '3íšŒ ì§„í–‰ Â· ì¼ì • ë³„ë„ í˜‘ì˜', price: 1100000, priceLabel: '110ë§Œì›', sessions: 3, premium: true, category: 'consultation' as const },
  ];
  const getConsultDow = (y: number, m: number, d: number) => ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][new Date(y, m-1, d).getDay()];
  const isConsultMonthPast = (m: number) => { const now = new Date(); return new Date(CONSULT_YEAR, m-1, 28) < now; };
  const handleConsultSelectType = (type: any) => { setConsultSelectedType(type); setConsultSelectedMonth(null); setConsultView(type.category === 'lecture' ? 'schedule' : 'confirm'); };
  const handleConsultSelectMonth = (m: number) => { if (isConsultMonthPast(m)) return; setConsultSelectedMonth(consultSelectedMonth === m ? null : m); };
  const handleConsultGoBack = () => { if (consultView === 'confirm' && consultSelectedType?.category === 'lecture') { setConsultView('schedule'); return; } setConsultView('list'); setConsultSelectedType(null); setConsultSelectedMonth(null); };
  const handleConsultPayment = () => { const typeId = consultSelectedType?.id; if (!typeId) return; const payUrl = PAYPLE_LINKS[typeId]; const sd = consultSelectedType?.scheduleType ? CONSULT_SCHEDULE[consultSelectedType.scheduleType] : null; const dates = sd && consultSelectedMonth ? sd.months[consultSelectedMonth] : []; setConsultBookings(prev => [...prev, { id: Date.now(), type: consultSelectedType, month: consultSelectedMonth, dates }]); setConsultToast(consultSelectedMonth ? `${CONSULT_YEAR}ë…„ ${consultSelectedMonth}ì›” (${dates.length}íšŒ) ê²°ì œ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤` : `${consultSelectedType.title} ê²°ì œ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤`); setTimeout(() => setConsultToast(null), 2800); if (payUrl) window.open(payUrl, '_blank'); setConsultView('list'); setConsultSelectedType(null); setConsultSelectedMonth(null); };
  const openExpertConsultModal = () => { setShowExpertConsult(true); setConsultView('list'); setConsultSelectedType(null); setConsultSelectedMonth(null); };
  const closeExpertConsultModal = () => { setShowExpertConsult(false); setConsultView('list'); setConsultSelectedType(null); setConsultSelectedMonth(null); };
  const consultScheduleData = consultSelectedType?.scheduleType ? CONSULT_SCHEDULE[consultSelectedType.scheduleType] : null;
  const consultAvailableMonths = consultScheduleData ? Object.keys(consultScheduleData.months).map(Number) : [];
  const displayName = userName.split('(')[0].trim();
  const financialHouseData = (() => { try { const raw = localStorage.getItem('financialHouseData'); if (!raw) return null; return JSON.parse(raw); } catch { return null; } })();
  const wealthIndexToLevel = (wi: number): number => { if (wi <= 0) return 1; if (wi <= 50) return 2; if (wi <= 100) return 3; if (wi <= 200) return 4; return 5; };
  const { houseLevel, actualWealthIndex } = (() => {
    if (_financialResult && _financialResult.wealthIndex > 0) { return { houseLevel: _financialResult.level || wealthIndexToLevel(_financialResult.wealthIndex), actualWealthIndex: _financialResult.wealthIndex }; }
    if (financialHouseData) { const p = financialHouseData.personalInfo; const inc = financialHouseData.income; const ageVal = p?.age || 0; const monthlyIncome = (inc?.myIncome || 0) + (inc?.spouseIncome || 0) + (inc?.otherIncome || 0); const totalAsset = financialHouseData.totalAsset || 0; const totalDebt = financialHouseData.debts?.totalDebt || 0; const netAsset = totalAsset - totalDebt; if (ageVal <= 0 || monthlyIncome <= 0) { return { houseLevel: 1 as number, actualWealthIndex: 0 }; } const wi = (netAsset * 10) / (ageVal * monthlyIncome * 12) * 100; return { houseLevel: wealthIndexToLevel(wi), actualWealthIndex: Math.round(wi) }; }
    return { houseLevel: null as number | null, actualWealthIndex: 0 };
  })();
  const HOUSE_LEVELS = [ { level: 1, house: 'ğŸšï¸', houseName: 'ì´ˆê°€ì§‘', weather: 'â›ˆï¸', bgColor: 'from-red-100 to-red-50', label: 'ë¯¸í¡' }, { level: 2, house: 'ğŸ ', houseName: 'ë‚˜ë¬´ì§‘', weather: 'â˜ï¸', bgColor: 'from-orange-100 to-orange-50', label: 'ë³´í†µ' }, { level: 3, house: 'ğŸ¡', houseName: 'ë²½ëŒì§‘', weather: 'â›…', bgColor: 'from-yellow-100 to-yellow-50', label: 'ì–‘í˜¸' }, { level: 4, house: 'ğŸ›ï¸', houseName: 'ì½˜í¬ë¦¬íŠ¸', weather: 'â˜€ï¸', bgColor: 'from-blue-100 to-blue-50', label: 'ìš°ìˆ˜' }, { level: 5, house: 'ğŸ°', houseName: 'ê³ ê¸‰ì£¼íƒ', weather: 'ğŸŒˆ', bgColor: 'from-emerald-100 to-emerald-50', label: 'í›Œë¥­' } ];
  const currentHouseInfo = houseLevel ? HOUSE_LEVELS[houseLevel - 1] : null;
  const desireStage: number | null = (() => { if (!financialHouseData) return null; if (financialHouseData.desireStage?.stage) return financialHouseData.desireStage.stage; return 1; })();
  const desireTextColor = desireStage ? ['text-red-600', 'text-orange-600', 'text-yellow-600', 'text-blue-600', 'text-purple-600', 'text-emerald-600'][desireStage - 1] : 'text-gray-400';

  return (
    <div className="min-h-screen bg-gray-50 pb-24">
      {/* â”€â”€â”€ í”„ë¡œí•„ ì„¹ì…˜ â”€â”€â”€ */}
      <div className="bg-white p-5 border-b border-gray-200">
        <div className="flex gap-4">
          <div className="flex-1 flex flex-col justify-between">
            <div className="flex items-center gap-3 mb-3"><img src={LOGO_URL} alt="AIë¨¸ë‹ˆì•¼ ë¡œê³ " className="w-14 h-14" /><div><p className="font-extrabold text-lg text-gray-900">{displayName}ë‹˜</p><p className="text-sm text-gray-500">{userEmail}</p></div></div>
            <div className="inline-flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-purple-50 to-indigo-50 border border-purple-200 rounded-xl self-start"><span className="text-base">ğŸ‘‘</span><span className="text-sm font-bold text-purple-600">í”„ë¦¬ë¯¸ì—„ê¸‰ ì´ìš© ì¤‘</span><span className="text-xs text-gray-500 ml-1">ë¬´ë£Œì²´í—˜</span></div>
          </div>
          <div className="flex flex-col items-center justify-center w-32">
            {currentHouseInfo ? (<><div className={`w-24 h-24 rounded-2xl bg-gradient-to-br ${currentHouseInfo.bgColor} flex flex-col items-center justify-center shadow-md border border-gray-100`}><span className="text-base mb-0.5">{currentHouseInfo.weather}</span><span className="text-4xl">{currentHouseInfo.house}</span><span className="text-[10px] text-gray-600 font-semibold mt-0.5">{currentHouseInfo.houseName}</span></div><div className="w-full mt-2">{desireStage ? (<><div className="flex items-center justify-center gap-1 mb-1.5"><span className={`text-xs font-bold ${desireTextColor}`}>DESIRE</span><span className="text-xs text-gray-600 font-semibold">{desireStage}ë‹¨ê³„</span></div><div className="flex gap-1">{[1,2,3,4,5,6].map((step) => (<div key={step} className={`h-2 flex-1 rounded-full ${step <= desireStage ? step <= 2 ? 'bg-red-400' : step <= 4 ? 'bg-yellow-400' : 'bg-emerald-400' : 'bg-gray-200'}`} />))}</div><div className="flex justify-between mt-1">{[1,2,3,4,5,6].map((step) => (<span key={step} className={`text-[9px] ${step === desireStage ? 'font-bold text-gray-800' : 'text-gray-400'}`}>{step}</span>))}</div></>) : (<div className="text-center mt-1"><span className="text-[9px] text-gray-400">ë¶€ìì§€ìˆ˜ {actualWealthIndex.toLocaleString()}%</span></div>)}</div></>) : (<div className="w-24 h-24 rounded-2xl bg-gray-100 flex flex-col items-center justify-center border border-gray-200"><span className="text-3xl mb-1">ğŸ </span><span className="text-[9px] text-gray-400 text-center">ì¬ë¬´ì„¤ê³„ë¥¼<br/>ì‹œì‘í•˜ì„¸ìš”</span></div>)}
          </div>
        </div>
      </div>
      {/* â”€â”€â”€ ì˜¤ìƒì—´ CFP ë°°ë„ˆ â”€â”€â”€ */}
      <div className="mx-4 mt-3"><div className="bg-gradient-to-r from-amber-50 to-yellow-50 border border-amber-200 rounded-xl p-4 flex items-center gap-3"><img src={PROFILE_IMAGE_URL} alt="ì˜¤ìƒì—´ CFP" className="w-14 h-14 rounded-full object-cover border-2 border-amber-300" /><div className="flex-1"><p className="text-sm font-bold text-amber-800">ì˜¤ìƒì—´ CFP</p><p className="text-xs text-amber-600">20ë…„ ê²½ë ¥ ì¬ë¬´ì„¤ê³„ ì „ë¬¸ê°€</p><p className="text-xs text-amber-500 mt-0.5">ì˜¤ì›íŠ¸ê¸ˆìœµì—°êµ¬ì†Œ ëŒ€í‘œ</p></div><button onClick={openExpertConsultModal} className="px-3 py-2 bg-amber-500 text-white text-xs font-bold rounded-lg hover:bg-amber-600">ê°•ì˜ìƒë‹´ì‹ ì²­</button></div></div>
      {/* â”€â”€â”€ ë©”ë‰´ ë¦¬ìŠ¤íŠ¸ (v2.8.1: ê¸ˆìœµê°ë…ì› ê°•ì˜ì˜ìƒ ë³µì›) â”€â”€â”€ */}
      <div className="mx-4 mt-3 bg-white rounded-xl shadow-sm overflow-hidden">
        <button onClick={() => setShowDesireRoadmap(true)} className="w-full flex items-center gap-3 px-4 py-3.5 border-b border-gray-100 hover:bg-gray-50 text-left"><span className="w-8 h-8 bg-gradient-to-br from-emerald-400 to-teal-500 rounded-lg flex items-center justify-center text-white text-sm">ğŸ—ºï¸</span><span className="flex-1 text-sm font-semibold text-gray-700">DESIRE ë¡œë“œë§µ</span><span className="text-xs text-emerald-500 font-bold">NEW</span><span className="text-gray-400 text-sm">â€º</span></button>
        <button onClick={() => setShowMembership(true)} className="w-full flex items-center gap-3 px-4 py-3.5 border-b border-gray-100 hover:bg-gray-50 text-left"><span className="w-8 h-8 bg-gradient-to-br from-purple-400 to-indigo-500 rounded-lg flex items-center justify-center text-white text-sm">ğŸ‘‘</span><span className="flex-1 text-sm font-semibold text-gray-700">ë©¤ë²„ì‹­ í”Œëœ</span><span className="text-gray-400 text-sm">â€º</span></button>
        <button onClick={() => setShowOnlineCourse(true)} className="w-full flex items-center gap-3 px-4 py-3.5 border-b border-gray-100 hover:bg-gray-50 text-left"><span className="w-8 h-8 bg-gradient-to-br from-blue-400 to-blue-500 rounded-lg flex items-center justify-center text-white text-sm">ğŸ“</span><span className="flex-1 text-sm font-semibold text-gray-700">ì˜¨ë¼ì¸ê°•ì¢Œ 107ê°• ì‹ ì²­</span><span className="text-gray-400 text-sm">â€º</span></button>
        <button onClick={() => onNavigate('podcast')} className="w-full flex items-center gap-3 px-4 py-3.5 border-b border-gray-100 hover:bg-gray-50 text-left"><span className="w-8 h-8 bg-gradient-to-br from-slate-600 to-slate-800 rounded-lg flex items-center justify-center text-white text-sm">ğŸ™ï¸</span><span className="flex-1 text-sm font-semibold text-gray-700">íŒŸìºìŠ¤íŠ¸ ì½”ë„ˆ</span><span className="text-xs text-emerald-500 font-bold">NEW</span><span className="text-gray-400 text-sm">â€º</span></button>
        <button onClick={() => setShowEbook(true)} className="w-full flex items-center gap-3 px-4 py-3.5 border-b border-gray-100 hover:bg-gray-50 text-left"><span className="w-8 h-8 bg-gradient-to-br from-orange-400 to-orange-500 rounded-lg flex items-center justify-center text-white text-sm">ğŸ“–</span><span className="flex-1 text-sm font-semibold text-gray-700">ê¸ˆìœµì§‘ì§“ê¸°Â® ì „ìì±…</span><span className="text-gray-400 text-sm">â€º</span></button>
        <button onClick={openExpertConsultModal} className="w-full flex items-center gap-3 px-4 py-3.5 border-b border-gray-100 hover:bg-gray-50 text-left"><span className="w-8 h-8 bg-gradient-to-br from-pink-400 to-rose-500 rounded-lg flex items-center justify-center text-white text-sm">ğŸ‘¨â€ğŸ«</span><span className="flex-1 text-sm font-semibold text-gray-700">ì˜¤ìƒì—´ ëŒ€í‘œ ê°•ì˜Â·ìƒë‹´ ì‹ ì²­</span><span className="text-gray-400 text-sm">â€º</span></button>
        {/* â˜…â˜…â˜… v2.8.1 ë³µì›: ê¸ˆìœµê°ë…ì› ì „ë¬¸ê°€ ê°•ì˜ì˜ìƒ â˜…â˜…â˜… */}
        <button onClick={() => window.open('https://www.fss.or.kr/fss/ntcn/fncsusvPrMng/view.do?dataSlno=78&dataTrgtCode=02&menuNo=200266', '_blank')} className="w-full flex items-center gap-3 px-4 py-3.5 border-b border-gray-100 hover:bg-gray-50 text-left"><span className="w-8 h-8 bg-gradient-to-br from-red-400 to-pink-500 rounded-lg flex items-center justify-center text-white text-sm">ğŸ¬</span><span className="flex-1 text-sm font-semibold text-gray-700">ê¸ˆìœµê°ë…ì› ì „ë¬¸ê°€ ê°•ì˜ì˜ìƒ</span><span className="text-gray-400 text-sm">â€º</span></button>
        <button onClick={() => onNavigate('monthly-report')} className="w-full flex items-center gap-3 px-4 py-3.5 border-b border-gray-100 hover:bg-gray-50 text-left"><span className="w-8 h-8 bg-gradient-to-br from-cyan-400 to-cyan-500 rounded-lg flex items-center justify-center text-white text-sm">ğŸ“Š</span><span className="flex-1 text-sm font-semibold text-gray-700">ì›”ê°„ ë¦¬í¬íŠ¸</span><span className="text-gray-400 text-sm">â€º</span></button>
        <button onClick={handleInquiry} className="w-full flex items-center gap-3 px-4 py-3.5 border-b border-gray-100 hover:bg-gray-50 text-left"><span className="w-8 h-8 bg-gradient-to-br from-green-400 to-green-500 rounded-lg flex items-center justify-center text-white text-sm">ğŸ’¬</span><span className="flex-1 text-sm font-semibold text-gray-700">1:1 ë¬¸ì˜í•˜ê¸°</span><span className="text-gray-400 text-sm">â€º</span></button>
        <button onClick={() => setShowShare(true)} className="w-full flex items-center gap-3 px-4 py-3.5 hover:bg-gray-50 text-left"><span className="w-8 h-8 bg-gradient-to-br from-violet-400 to-violet-500 rounded-lg flex items-center justify-center text-white text-sm">ğŸ”—</span><span className="flex-1 text-sm font-semibold text-gray-700">ì¹œêµ¬ì—ê²Œ ê³µìœ í•˜ê¸°</span><span className="text-gray-400 text-sm">â€º</span></button>
      </div>
      {/* â”€â”€â”€ ê¸°íƒ€ ë©”ë‰´ â”€â”€â”€ */}
      <div className="mx-4 mt-3 mb-4">
        <div className="bg-white rounded-xl shadow-sm overflow-hidden">
          <button onClick={() => { if (!pinEnabledState) { setPinMode('setup'); setShowPinSetup(true); } }} className="w-full flex items-center gap-3 px-4 py-3 border-b border-gray-100 hover:bg-gray-50 text-left"><span className="text-gray-400">ğŸ”</span><div className="flex-1"><span className="text-sm text-gray-600">ì•± ì ê¸ˆ ì„¤ì •</span><p className="text-xs text-gray-400">PIN ë²ˆí˜¸ë¡œ ì•±ì„ ë³´í˜¸í•©ë‹ˆë‹¤</p></div><span className={`text-xs font-bold px-2 py-0.5 rounded-full ${pinEnabledState ? 'bg-green-100 text-green-600' : 'bg-gray-100 text-gray-400'}`}>{pinEnabledState ? 'ON' : 'OFF'}</span></button>
          {pinEnabledState && (<><button onClick={() => { setPinMode('change'); setShowPinSetup(true); }} className="w-full flex items-center gap-3 px-4 py-2.5 pl-12 border-b border-gray-100 hover:bg-gray-50 text-left"><span className="text-sm text-gray-500">ğŸ”„ PIN ë³€ê²½</span></button><button onClick={() => { setPinMode('disable'); setShowPinSetup(true); }} className="w-full flex items-center gap-3 px-4 py-2.5 pl-12 border-b border-gray-100 hover:bg-gray-50 text-left"><span className="text-sm text-red-400">ğŸ”“ PIN í•´ì œ</span></button></>)}
          <button onClick={() => setShowSettings(true)} className="w-full flex items-center gap-3 px-4 py-3 border-b border-gray-100 hover:bg-gray-50 text-left"><span className="text-gray-400">âš™ï¸</span><span className="flex-1 text-sm text-gray-600">ì„¤ì •</span><span className="text-gray-300">â€º</span></button>
          <button onClick={() => setShowFAQ(true)} className="w-full flex items-center gap-3 px-4 py-3 border-b border-gray-100 hover:bg-gray-50 text-left"><span className="text-gray-400">â“</span><span className="flex-1 text-sm text-gray-600">ê³ ê°ì„¼í„° / FAQ</span><span className="text-gray-400 text-sm">â€º</span></button>
          <button onClick={() => setShowTerms(true)} className="w-full flex items-center gap-3 px-4 py-3 border-b border-gray-100 hover:bg-gray-50 text-left"><span className="text-gray-400">ğŸ“„</span><span className="flex-1 text-sm text-gray-600">ì´ìš©ì•½ê´€</span><span className="text-gray-400 text-sm">â€º</span></button>
          <button onClick={() => setShowPrivacy(true)} className="w-full flex items-center gap-3 px-4 py-3 border-b border-gray-100 hover:bg-gray-50 text-left"><span className="text-gray-400">ğŸ”’</span><span className="flex-1 text-sm text-gray-600">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</span><span className="text-gray-400 text-sm">â€º</span></button>
          <button onClick={() => { if (window.confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) onLogout(); }} className="w-full flex items-center gap-3 px-4 py-3 border-b border-gray-100 hover:bg-gray-50 text-left"><span className="text-gray-400">ğŸšª</span><span className="flex-1 text-sm text-gray-600">ë¡œê·¸ì•„ì›ƒ</span></button>
          <button onClick={() => setShowWithdraw(true)} className="w-full flex items-center gap-3 px-4 py-3 border-b border-gray-100 hover:bg-gray-50 text-left"><span className="text-gray-400">ğŸ—‘ï¸</span><span className="flex-1 text-sm text-red-400">íšŒì›íƒˆí‡´</span></button>
          <button onClick={handleResetClick} className="w-full flex items-center gap-3 px-4 py-3 hover:bg-gray-50 text-left"><span className="text-gray-400">âš ï¸</span><span className="flex-1 text-sm text-red-500 font-semibold">ì²˜ìŒë¶€í„° ë‹¤ì‹œí•˜ê¸°</span></button>
        </div>
        <p className="text-center text-xs text-gray-400 mt-3">ì•± ë²„ì „ v2.8.1 (AIë¨¸ë‹ˆì•¼)</p>
      </div>

      {/* â•â•â• DESIRE ë¡œë“œë§µ ëª¨ë‹¬ â•â•â• */}
      {showDesireRoadmap && (
        <div className="fixed inset-0 bg-black/50 z-50 flex items-end justify-center">
          <div className="bg-white w-full max-w-lg rounded-t-2xl max-h-[90vh] overflow-y-auto">
            <div className="sticky top-0 bg-gradient-to-r from-emerald-500 to-teal-600 p-4 rounded-t-2xl flex items-center z-10"><button onClick={() => setShowDesireRoadmap(false)} className="text-white text-xl mr-3">â†</button><div className="flex-1"><h2 className="text-white text-lg font-bold">ğŸ† ë„ì „! DESIRE ë¡œë“œë§µ</h2><p className="text-emerald-100 text-xs">í˜„ì¬ {[1,2,3,4,5].filter(s => isStageComplete(s)).length > 0 ? `${[1,2,3,4,5].filter(s => isStageComplete(s)).length}ë‹¨ê³„ ì™„ë£Œ` : 'ì‹œì‘ ì „'} Â· ë‚˜ì˜ ê¸ˆìœµ ììœ  ì—¬ì •</p></div></div>
            <div className="px-4 py-3 bg-emerald-50"><div className="flex justify-between text-xs mb-1"><span className="text-emerald-700 font-semibold">ì „ì²´ ì§„í–‰ë¥ </span><span className="text-emerald-600 font-bold">{[1,2,3,4,5].filter(s => isStageComplete(s)).length}/6</span></div><div className="w-full h-2.5 bg-emerald-200 rounded-full overflow-hidden"><div className="h-full bg-gradient-to-r from-emerald-400 to-teal-500 rounded-full transition-all duration-500" style={{ width: `${([1,2,3,4,5].filter(s => isStageComplete(s)).length / 6) * 100}%` }} /></div></div>
            <div className="px-4 pt-3 pb-1">
              {!showStoryForm ? (<button onClick={() => setShowStoryForm(true)} className="w-full flex items-center gap-3 p-4 bg-gradient-to-r from-teal-50 to-emerald-50 border-2 border-teal-200 rounded-xl hover:border-teal-400 transition-all"><span className="text-2xl">âœ‰ï¸</span><div className="flex-1 text-left"><p className="text-sm font-bold text-teal-800">ë‚˜ì˜ DESIRE ì‚¬ì—° ë³´ë‚´ê¸°</p><p className="text-xs text-teal-600">ì„ ì • ì‹œ ì˜¤ìƒì—´ CFP 1:1 ë¯¸ë‹ˆìƒë‹´ + ì „ìì±… ì„ ë¬¼!</p></div><span className="text-teal-400 text-lg">â€º</span></button>
              ) : storySubmitted ? (<div className="bg-emerald-50 rounded-xl p-6 text-center border-2 border-emerald-200"><p className="text-4xl mb-3">ğŸ‰</p><h4 className="text-lg font-bold text-emerald-700 mb-2">ì‚¬ì—°ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!</h4><p className="text-sm text-emerald-600 mb-1">ê²€í†  í›„ ì„ ì • ê²°ê³¼ë¥¼ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.</p><p className="text-xs text-gray-500 mb-4">ì„ ì • ì‹œ 1:1 ë¯¸ë‹ˆìƒë‹´ + ì „ìì±… ì„ ë¬¼ ì¦ì •</p><button onClick={resetStoryForm} className="px-6 py-2 bg-emerald-500 text-white text-sm font-semibold rounded-lg">í™•ì¸</button></div>
              ) : (<div className="bg-white rounded-xl border-2 border-teal-200 overflow-hidden"><div className="bg-gradient-to-r from-teal-500 to-emerald-500 p-4 flex items-center"><button onClick={() => setShowStoryForm(false)} className="text-white text-lg mr-3">â†</button><div><h4 className="text-white text-sm font-bold">âœ‰ï¸ ë‚˜ì˜ DESIRE ì‚¬ì—° ë³´ë‚´ê¸°</h4><p className="text-teal-100 text-xs">ì„ ì • ì‹œ 1:1 ë¯¸ë‹ˆìƒë‹´ + ì „ìì±… ì„ ë¬¼!</p></div></div><div className="p-4 space-y-4"><div><label className="block text-xs font-semibold text-gray-700 mb-1">ë‹‰ë„¤ì„ <span className="text-red-500">*</span></label><input type="text" value={storyNickname} onChange={e => setStoryNickname(e.target.value)} placeholder="ë°©ì†¡ì—ì„œ ì‚¬ìš©ë  ë‹‰ë„¤ì„" className="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-teal-400 focus:outline-none transition" /></div><div><label className="block text-xs font-semibold text-gray-700 mb-2">DESIRE ë‹¨ê³„ <span className="text-red-500">*</span></label><div className="flex flex-wrap gap-2">{DESIRE_CHIP_OPTIONS.map(chip => (<button key={chip.key} onClick={() => setStoryDesireStage(chip.key)} className={`px-3 py-1.5 rounded-full text-xs font-medium border transition-all ${storyDesireStage === chip.key ? 'bg-teal-500 text-white border-teal-500' : 'bg-white text-gray-500 border-gray-200 hover:border-teal-300'}`}>{chip.label}</button>))}</div></div><div><label className="block text-xs font-semibold text-gray-700 mb-1">ë‚˜ì˜ ì‚¬ì—° <span className="text-red-500">*</span></label><textarea value={storyContent} onChange={e => setStoryContent(e.target.value)} placeholder={"í˜„ì¬ ì¬ì • ìƒí™©ê³¼ ê³ ë¯¼ì„ ììœ ë¡­ê²Œ ì ì–´ì£¼ì„¸ìš”.\n\nì˜ˆ) ì¹´ë“œë¹š 3000ë§Œì›, ëŒ€ì¶œ 5000ë§Œì›ìœ¼ë¡œ ë§¤ë‹¬ ì´ìë§Œ 50ë§Œì›ì…ë‹ˆë‹¤..."} className="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm h-32 resize-none focus:border-teal-400 focus:outline-none transition" /><p className="text-xs text-gray-400 mt-1">ìµœì†Œ 50ì ì´ìƒ ì‘ì„±í•´ ì£¼ì„¸ìš” ({storyContent.length}ì)</p></div><div><label className="block text-xs font-semibold text-gray-700 mb-1">ì—°ë½ì²˜ (ì„ íƒ)</label><input type="text" value={storyContact} onChange={e => setStoryContact(e.target.value)} placeholder="ì „í™”ë²ˆí˜¸ ë˜ëŠ” ì´ë©”ì¼" className="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm focus:border-teal-400 focus:outline-none transition" /><p className="text-xs text-gray-400 mt-1">ì„ ì • ì‹œ ì—°ë½ ë° ì„ ë¬¼ ë°œì†¡ì— ì‚¬ìš©ë©ë‹ˆë‹¤</p></div><label className="flex items-start gap-2 cursor-pointer"><input type="checkbox" checked={storyAgree} onChange={e => setStoryAgree(e.target.checked)} className="mt-0.5 accent-teal-500" /><span className="text-xs text-gray-500 leading-relaxed">ì‚¬ì—°ì´ ë°©ì†¡ì— ì‚¬ìš©ë  ìˆ˜ ìˆìœ¼ë©°, ê°œì¸ì •ë³´ëŠ” ë°©ì†¡ ì œì‘ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤.</span></label><button onClick={handleStorySubmit} className="w-full py-3 bg-gradient-to-r from-teal-500 to-emerald-500 text-white text-sm font-bold rounded-xl hover:shadow-lg transition">âœ‰ï¸ ì‚¬ì—° ë³´ë‚´ê¸°</button><p className="text-xs text-gray-400 text-center leading-relaxed">ì œì¶œëœ ì‚¬ì—°ì€ ê²€í†  í›„ ì„ ì •ë˜ë©°,<br />ì„ ì • ê²°ê³¼ëŠ” ì•± ì•Œë¦¼ìœ¼ë¡œ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.</p></div></div>)}
            </div>
            <input ref={photoInputRef} type="file" accept="image/*" capture="environment" className="hidden" onChange={handlePhotoChange} />
            <div className="p-4 space-y-3">
              {DESIRE_STAGES.map((stage) => { const isComplete = isStageComplete(stage.stage); const isExpanded = desireExpandedStage === stage.stage; const isLocked = stage.stage === 6 && !isStageComplete(6); const detail = desireStageDetails[stage.stage]; return (
                <div key={stage.stage} className="rounded-xl overflow-hidden border-2 transition-all" style={{ borderColor: isComplete ? stage.color : '#e5e7eb' }}>
                  <button onClick={() => { if (isLocked) return; setDesireExpandedStage(isExpanded ? null : stage.stage); }} className="w-full flex items-center gap-3 p-3 text-left transition-opacity" style={{ background: `linear-gradient(135deg, ${stage.bgFrom}, ${stage.bgTo})`, opacity: isLocked ? 0.4 : 1 }}><div className="w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-sm shadow" style={{ background: stage.color }}>{isComplete ? 'âœ“' : stage.letter}</div><div className="flex-1 min-w-0"><div className="flex items-center gap-2"><span className="text-xs font-bold" style={{ color: stage.color }}>STEP {stage.stage}</span>{isComplete && <span className="text-xs bg-green-500 text-white px-1.5 py-0.5 rounded-full">ì™„ë£Œ</span>}{isLocked && <span className="text-xs">ğŸ”’</span>}</div><p className="text-sm font-semibold text-gray-800">{stage.title}</p>{detail && <p className="text-xs text-gray-500 mt-0.5 truncate">{detail.summary}</p>}</div><span className="text-xl">{stage.house}</span>{!isLocked && <span className="text-gray-400 text-sm">{isExpanded ? 'â–²' : 'â–¼'}</span>}</button>
                  {isExpanded && !isLocked && (<div className="bg-white p-4 border-t border-gray-100">
                    {stage.stage === 1 && (<div className="space-y-2">{(detail?.creditLoans || []).length > 0 ? (<><p className="text-xs text-gray-500 mb-2">ğŸ“Œ ê³ ê¸ˆë¦¬ ìˆœìœ¼ë¡œ ìƒí™˜í•˜ì„¸ìš”</p>{detail!.creditLoans!.map((loan) => (<label key={`cl-${loan.id}`} className="flex items-center gap-3 p-3 bg-red-50 rounded-lg cursor-pointer hover:bg-red-100 transition"><input type="checkbox" checked={!!desireLoanChecks[`cl-${loan.id}`]} onChange={() => handleLoanCheck(`cl-${loan.id}`)} className="w-5 h-5 rounded accent-red-500" /><div className="flex-1 min-w-0"><p className={`text-sm font-semibold ${desireLoanChecks[`cl-${loan.id}`] ? 'line-through text-gray-400' : 'text-gray-800'}`}>{loan.name}</p><p className="text-xs text-gray-500">{(loan.amount / 10000).toLocaleString()}ë§Œì›</p></div><span className="text-sm font-bold text-red-600">{loan.rate}%</span></label>))}<p className="text-xs text-gray-400 text-center mt-2">ì§„í–‰: {Object.keys(desireLoanChecks).filter(k => k.startsWith('cl-') && desireLoanChecks[k]).length}/{detail!.creditLoans!.length}ê±´ ì™„ë£Œ</p></>) : (<div className="text-center py-4"><p className="text-3xl mb-2">âœ…</p><p className="text-sm text-green-600 font-semibold">ì‹ ìš©ëŒ€ì¶œì´ ì—†ìŠµë‹ˆë‹¤!</p></div>)}</div>)}
                    {stage.stage === 2 && detail?.emergencyFund && (<div className="space-y-3"><div className="flex justify-between text-xs text-gray-600"><span>í˜„ì¬: <strong className="text-orange-600">{(detail.emergencyFund.current / 10000).toLocaleString()}ë§Œì›</strong></span><span>ëª©í‘œ: <strong>{(detail.emergencyFund.target / 10000).toLocaleString()}ë§Œì›</strong></span></div><div className="w-full h-4 bg-gray-200 rounded-full overflow-hidden"><div className="h-full rounded-full transition-all duration-700" style={{ width: `${Math.min(100, detail.emergencyFund.target > 0 ? (detail.emergencyFund.current / detail.emergencyFund.target) * 100 : 0)}%`, background: `linear-gradient(90deg, #ea580c, #f97316)` }} /></div><p className="text-center text-xs text-gray-500">ë‹¬ì„±ë¥  <strong className="text-orange-600">{detail.emergencyFund.target > 0 ? Math.round((detail.emergencyFund.current / detail.emergencyFund.target) * 100) : 0}%</strong>{detail.emergencyFund.secured && ' âœ…'}</p></div>)}
                    {stage.stage === 2 && !detail?.emergencyFund && (<div className="text-center py-4 text-gray-400 text-sm">ê¸ˆìœµì§‘ì§“ê¸°ì—ì„œ ë¹„ìƒì˜ˆë¹„ìê¸ˆì„ ì„¤ì •í•´ì£¼ì„¸ìš”</div>)}
                    {stage.stage === 3 && detail?.savings && (<div className="space-y-3"><div className="grid grid-cols-2 gap-2"><div className="bg-yellow-50 rounded-lg p-3 text-center"><p className="text-xs text-gray-500">ì›” ì €ì¶•íˆ¬ì</p><p className="text-lg font-bold text-yellow-700">{(detail.savings.monthlySaving / 10000).toLocaleString()}<span className="text-xs font-normal">ë§Œì›</span></p></div><div className="bg-yellow-50 rounded-lg p-3 text-center"><p className="text-xs text-gray-500">ì›” ë…¸í›„ì—°ê¸ˆ</p><p className="text-lg font-bold text-yellow-700">{(detail.savings.monthlyPension / 10000).toLocaleString()}<span className="text-xs font-normal">ë§Œì›</span></p></div></div>{detail.savings.irregularIncome > 0 && (<div className="bg-amber-50 rounded-lg p-3 text-center"><p className="text-xs text-gray-500">ë¹„ì •ê¸° ìˆ˜ì…</p><p className="text-base font-bold text-amber-700">{(detail.savings.irregularIncome / 10000).toLocaleString()}ë§Œì›</p></div>)}<p className="text-xs text-gray-400 text-center">í•©ê³„: ì›” {((detail.savings.monthlySaving + detail.savings.monthlyPension) / 10000).toLocaleString()}ë§Œì›</p></div>)}
                    {stage.stage === 3 && !detail?.savings && (<div className="text-center py-4 text-gray-400 text-sm">ê¸ˆìœµì§‘ì§“ê¸°ì—ì„œ ì €ì¶•/ì—°ê¸ˆì„ ì„¤ì •í•´ì£¼ì„¸ìš”</div>)}
                    {stage.stage === 4 && detail?.investment && (<div className="space-y-3"><div className="text-center mb-2"><p className="text-3xl font-bold text-blue-600">{(detail.investment.financialAssets / 100000000).toFixed(1)}<span className="text-sm font-normal text-gray-500">ì–µì›</span></p><p className="text-xs text-gray-400">ëª©í‘œ: 10ì–µì›</p></div><div className="w-full h-4 bg-gray-200 rounded-full overflow-hidden"><div className="h-full rounded-full transition-all duration-700" style={{ width: `${Math.min(100, (detail.investment.financialAssets / detail.investment.target) * 100)}%`, background: `linear-gradient(90deg, #2563eb, #3b82f6)` }} /></div><p className="text-center text-xs text-gray-500">ë‹¬ì„±ë¥  <strong className="text-blue-600">{Math.round((detail.investment.financialAssets / detail.investment.target) * 100)}%</strong></p></div>)}
                    {stage.stage === 4 && !detail?.investment && (<div className="text-center py-4 text-gray-400 text-sm">ê¸ˆìœµì§‘ì§“ê¸°ì—ì„œ ê¸ˆìœµìì‚°ì„ ì…ë ¥í•´ì£¼ì„¸ìš”</div>)}
                    {stage.stage === 5 && (<div className="space-y-2">{(detail?.mortgageLoans || []).length > 0 ? (<><p className="text-xs text-gray-500 mb-2">ğŸ“Œ ë‹´ë³´ëŒ€ì¶œ ìƒí™˜ ê³„íš</p>{detail!.mortgageLoans!.map((loan) => (<label key={`ml-${loan.id}`} className="flex items-center gap-3 p-3 bg-purple-50 rounded-lg cursor-pointer hover:bg-purple-100 transition"><input type="checkbox" checked={!!desireLoanChecks[`ml-${loan.id}`]} onChange={() => handleLoanCheck(`ml-${loan.id}`)} className="w-5 h-5 rounded accent-purple-500" /><div className="flex-1 min-w-0"><p className={`text-sm font-semibold ${desireLoanChecks[`ml-${loan.id}`] ? 'line-through text-gray-400' : 'text-gray-800'}`}>{loan.name}</p><p className="text-xs text-gray-500">{(loan.amount / 10000).toLocaleString()}ë§Œì›</p></div><span className="text-sm font-bold text-purple-600">{loan.rate}%</span></label>))}<p className="text-xs text-gray-400 text-center mt-2">ì§„í–‰: {Object.keys(desireLoanChecks).filter(k => k.startsWith('ml-') && desireLoanChecks[k]).length}/{detail!.mortgageLoans!.length}ê±´ ì™„ë£Œ</p></>) : (<div className="text-center py-4"><p className="text-3xl mb-2">âœ…</p><p className="text-sm text-green-600 font-semibold">ë‹´ë³´ëŒ€ì¶œì´ ì—†ìŠµë‹ˆë‹¤!</p></div>)}</div>)}
                    {stage.stage === 6 && (<div className="text-center py-6">{!giftOpened ? (<><p className="text-5xl mb-3 animate-bounce">ğŸ</p><h4 className="text-lg font-bold text-emerald-700 mb-2">ì¶•í•˜ë“œë¦½ë‹ˆë‹¤!</h4><p className="text-sm text-gray-600 mb-1">DESIRE 6ë‹¨ê³„ë¥¼ ëª¨ë‘ ì™„ë£Œí•˜ì…¨ìŠµë‹ˆë‹¤!</p><p className="text-sm text-gray-600 mb-4">ì´ˆê°€ì§‘ì—ì„œ ì‹œì‘í•œ ê¸ˆìœµ ì—¬ì •ì´<br />ë§ˆì¹¨ë‚´ <strong className="text-emerald-600">ê³ ê¸‰ì£¼íƒ</strong>ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤!</p><button onClick={handleOpenGift} className="px-8 py-3 bg-gradient-to-r from-amber-400 to-amber-500 text-white text-sm font-bold rounded-xl shadow-lg hover:shadow-xl transition transform hover:scale-105">ğŸ ì„ ë¬¼í•¨ ì—´ê¸°</button></>) : (<><p className="text-5xl mb-3">ğŸ°</p><h4 className="text-lg font-bold text-emerald-700 mb-2">ê²½ì œì  ììœ  ë‹¬ì„±!</h4><p className="text-sm text-gray-500">ë‹¹ì‹ ì˜ ê¸ˆìœµì§‘ì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤ ğŸ‰</p></>)}</div>)}
                    {stage.stage <= 5 && (<div className="mt-4 pt-3 border-t border-gray-100 space-y-3"><button onClick={() => handleDesireComplete(stage.stage)} className={`w-full py-3 rounded-xl text-sm font-bold transition flex items-center justify-center gap-2 ${desireCompleted[stage.stage] ? 'bg-green-500 text-white' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}`}>{desireCompleted[stage.stage] ? 'âœ… ì™„ë£Œ!' : 'â˜ ì™„ë£Œ ì²´í¬'}</button><button onClick={() => handlePhotoAttach(stage.stage)} className="w-full py-2.5 rounded-xl text-xs font-semibold border-2 border-dashed border-gray-300 text-gray-500 hover:border-gray-400 hover:text-gray-600 transition flex items-center justify-center gap-2">ğŸ“· ì¸ì¦ìƒ· ì²¨ë¶€</button>{desirePhotos[stage.stage] && (<div className="relative"><img src={desirePhotos[stage.stage]} alt="ì¸ì¦ìƒ·" className="w-full h-40 object-cover rounded-xl border border-gray-200" onClick={() => window.open(desirePhotos[stage.stage], '_blank')} style={{ cursor: 'pointer' }} /><button onClick={() => { const next = { ...desirePhotos }; delete next[stage.stage]; setDesirePhotos(next); localStorage.setItem('desirePhotos', JSON.stringify(next)); }} className="absolute top-2 right-2 w-6 h-6 bg-black/50 rounded-full text-white text-xs flex items-center justify-center">âœ•</button></div>)}<p className="text-xs text-gray-400 text-center">ğŸ“ {stage.dataSource}</p></div>)}
                  </div>)}
                </div>
              ); })}
            </div>
            <div className="px-4 pb-6"><div className="bg-gray-50 rounded-xl p-4 text-center"><p className="text-xs text-gray-500 mb-2">ë‚˜ì˜ ê¸ˆìœµì§‘ ì§„í™”</p><div className="flex items-center justify-center gap-1 text-2xl flex-wrap">{DESIRE_STAGES.map((s, i) => (<span key={i} className={`transition-opacity ${isStageComplete(s.stage) ? '' : 'opacity-30'}`}>{i > 0 && <span className="text-sm text-gray-400 mx-0.5">â†’</span>}{s.house}</span>))}</div></div></div>
          </div>
        </div>
      )}
      {/* ì¶•í•˜ ëª¨ë‹¬ */}
      {showCelebration && (<div className="fixed inset-0 bg-black/60 z-[60] flex items-center justify-center p-4" onClick={() => setShowCelebration(false)}><div className="bg-white rounded-2xl p-6 max-w-sm w-full text-center relative overflow-hidden" onClick={e => e.stopPropagation()}><div className="absolute inset-0 pointer-events-none">{Array.from({ length: 30 }).map((_, i) => (<div key={i} className="absolute w-2 h-2 rounded-full animate-ping" style={{ left: `${Math.random() * 100}%`, top: `${Math.random() * 100}%`, background: ['#dc2626', '#ea580c', '#ca8a04', '#2563eb', '#7c3aed', '#059669', '#f59e0b', '#ec4899'][i % 8], animationDelay: `${Math.random() * 2}s`, animationDuration: `${1 + Math.random() * 2}s` }} />))}</div><p className="text-6xl mb-4 relative">ğŸŠ</p><h3 className="text-xl font-bold text-gray-800 mb-2 relative">ğŸ‰ DESIRE ì™„ì£¼! ğŸ‰</h3><p className="text-sm text-gray-600 mb-2 relative">ê¸ˆìœµ ììœ ë¥¼ í–¥í•œ ëª¨ë“  ë‹¨ê³„ë¥¼ ì™„ë£Œí•˜ì…¨ìŠµë‹ˆë‹¤!</p><p className="text-sm text-gray-500 mb-4 relative">ë‹¹ì‹ ì˜ ê¸ˆìœµì§‘ì´ ì™„ì„±ë˜ì—ˆì–´ìš”! ğŸ°</p><div className="flex items-center justify-center gap-1 text-2xl mb-4 relative"><span>ğŸšï¸</span><span className="text-sm">â†’</span><span>ğŸ¡</span><span className="text-sm">â†’</span><span>ğŸ </span><span className="text-sm">â†’</span><span>ğŸ¢</span><span className="text-sm">â†’</span><span>ğŸ›ï¸</span><span className="text-sm">â†’</span><span>ğŸ°</span></div><button onClick={() => setShowCelebration(false)} className="px-8 py-3 bg-gradient-to-r from-amber-400 to-amber-500 text-white font-bold rounded-xl relative">ê°ì‚¬í•©ë‹ˆë‹¤! ğŸ™</button></div></div>)}

      {/* â•â•â• ë©¤ë²„ì‹­ í”Œëœ ëª¨ë‹¬ â•â•â• */}
      {showMembership && (<div className="fixed inset-0 bg-black/50 z-50 flex items-end justify-center"><div className="bg-white w-full max-w-lg rounded-t-2xl max-h-[90vh] overflow-y-auto">
        <div className="sticky top-0 bg-gradient-to-r from-purple-600 to-indigo-600 p-4 rounded-t-2xl flex items-center"><button onClick={closeMembership} className="text-white text-xl mr-3">â†</button><div><h2 className="text-white text-lg font-bold">ğŸ‘‘ ë©¤ë²„ì‹­ í”Œëœ</h2><p className="text-purple-200 text-xs">ë‚˜ì—ê²Œ ë§ëŠ” í”Œëœì„ ì„ íƒí•˜ì„¸ìš”</p></div></div>
        {membershipStep === 'list' && (<><div className="flex mx-4 mt-3 bg-gray-100 rounded-xl p-1"><button onClick={() => setMembershipTab('general')} className={`flex-1 py-2.5 rounded-lg text-sm font-bold transition-all ${membershipTab === 'general' ? 'bg-white text-purple-600 shadow-sm' : 'text-gray-400'}`}>ğŸ  ì¼ë°˜ì¸</button><button onClick={() => setMembershipTab('fp')} className={`flex-1 py-2.5 rounded-lg text-sm font-bold transition-all ${membershipTab === 'fp' ? 'bg-white text-purple-600 shadow-sm' : 'text-gray-400'}`}>ğŸ’¼ ê¸ˆìœµì „ë¬¸ê°€(FP)</button></div>
          <div className="p-4 space-y-3">{(MEMBERSHIP_PLANS[membershipTab] || []).map(plan => (<div key={plan.tier} className={`bg-white rounded-xl border-2 p-4 ${plan.highlight ? 'border-purple-400 shadow-lg' : 'border-gray-200'} relative`}>{plan.highlight && <span className="absolute -top-2.5 right-4 bg-purple-500 text-white text-xs font-bold px-3 py-0.5 rounded-full">ì¶”ì²œ</span>}<div className="flex items-center gap-2 mb-2"><span className="text-xl">{plan.badge}</span><span className="text-sm font-bold text-gray-800">{plan.tier}</span>{plan.current && <span className="text-xs bg-gray-200 text-gray-500 px-2 py-0.5 rounded">í˜„ì¬</span>}</div><div className="mb-2">{plan.price === 0 ? (<span className="text-2xl font-extrabold text-gray-800">{plan.priceDisplay}</span>) : (<><span className="text-2xl font-extrabold text-gray-800">â‚©{plan.priceDisplay}</span><span className="text-sm text-gray-500">/ì›”</span></>)}</div><div className="space-y-1 mb-3">{plan.benefits.map((b, i) => (<p key={i} className="text-xs text-gray-600">âœ“ {b}</p>))}</div><button onClick={() => handleSelectPlan(plan)} className={`w-full py-2.5 rounded-lg text-sm font-bold transition ${plan.current ? 'bg-gray-100 text-gray-400' : plan.highlight ? 'bg-purple-500 text-white hover:bg-purple-600' : 'bg-gray-800 text-white hover:bg-gray-700'}`}>{plan.current ? 'í˜„ì¬ í”Œëœ' : 'ì„ íƒí•˜ê¸°'}</button></div>))}</div></>)}
        {membershipStep === 'cycle' && selectedMembershipPlan && (<div className="p-4"><button onClick={() => setMembershipStep('list')} className="text-sm text-gray-500 mb-4">â† ë’¤ë¡œ</button><h3 className="text-lg font-bold text-gray-800 mb-4">{selectedMembershipPlan.badge} {selectedMembershipPlan.tier} ê²°ì œ ì£¼ê¸°</h3><div className="space-y-3"><button onClick={() => handleSelectCycle('monthly')} className="w-full p-4 border-2 border-gray-200 rounded-xl text-left hover:border-purple-400 transition"><p className="text-sm font-bold text-gray-800">ì›”ê°„ ê²°ì œ</p><p className="text-xl font-extrabold text-purple-600">â‚©{selectedMembershipPlan.priceDisplay}/ì›”</p></button><button onClick={() => handleSelectCycle('annual')} className="w-full p-4 border-2 border-purple-400 rounded-xl text-left bg-purple-50 relative"><span className="absolute -top-2 right-4 bg-red-500 text-white text-xs font-bold px-2 py-0.5 rounded-full">17% í• ì¸</span><p className="text-sm font-bold text-gray-800">ì—°ê°„ ê²°ì œ</p><p className="text-xl font-extrabold text-purple-600">â‚©{selectedMembershipPlan.annualDisplay}/ë…„</p><p className="text-xs text-gray-500">ì›” â‚©{selectedMembershipPlan.annualMonthly} í™˜ì‚°</p></button></div></div>)}
        {membershipStep === 'payment' && selectedMembershipPlan && billingCycle && (<div className="p-4"><button onClick={() => setMembershipStep('cycle')} className="text-sm text-gray-500 mb-4">â† ë’¤ë¡œ</button><div className="bg-purple-50 rounded-xl p-4 mb-4"><p className="text-sm font-bold text-purple-800">{selectedMembershipPlan.badge} {selectedMembershipPlan.tier} Â· {billingCycle === 'monthly' ? 'ì›”ê°„' : 'ì—°ê°„'}</p><p className="text-2xl font-extrabold text-purple-600">â‚©{billingCycle === 'monthly' ? selectedMembershipPlan.priceDisplay : selectedMembershipPlan.annualDisplay}</p></div><div className="space-y-3"><div><label className="block text-xs font-semibold text-gray-700 mb-1">ì¹´ë“œë²ˆí˜¸</label><input type="text" value={cardNumber} onChange={e => setCardNumber(formatCardNumber(e.target.value))} placeholder="0000-0000-0000-0000" className="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm" /></div><div className="flex gap-3"><div className="flex-1"><label className="block text-xs font-semibold text-gray-700 mb-1">ìœ íš¨ê¸°ê°„</label><input type="text" value={cardExpiry} onChange={e => setCardExpiry(formatExpiry(e.target.value))} placeholder="MM/YY" className="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm" /></div><div className="flex-1"><label className="block text-xs font-semibold text-gray-700 mb-1">CVC</label><input type="password" value={cardCvc} onChange={e => setCardCvc(e.target.value.replace(/\D/g, '').slice(0, 3))} placeholder="000" className="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm" /></div></div><div><label className="block text-xs font-semibold text-gray-700 mb-1">ì¹´ë“œ ì†Œìœ ì</label><input type="text" value={cardHolder} onChange={e => setCardHolder(e.target.value)} placeholder="í™ê¸¸ë™" className="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm" /></div><button onClick={handlePay} disabled={isPayProcessing} className="w-full py-3 bg-purple-500 text-white font-bold rounded-xl hover:bg-purple-600 disabled:bg-gray-300 transition">{isPayProcessing ? 'ê²°ì œ ì²˜ë¦¬ ì¤‘...' : 'ê²°ì œí•˜ê¸°'}</button></div></div>)}
        {membershipStep === 'done' && (<div className="p-8 text-center"><p className="text-5xl mb-4">ğŸ‰</p><h3 className="text-xl font-bold text-gray-800 mb-2">ê²°ì œ ì™„ë£Œ!</h3><p className="text-sm text-gray-600 mb-6">{selectedMembershipPlan?.tier} í”Œëœì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.</p><button onClick={closeMembership} className="px-8 py-3 bg-purple-500 text-white font-bold rounded-xl">í™•ì¸</button></div>)}
      </div></div>)}

      {/* â•â•â• ì˜¨ë¼ì¸ê°•ì¢Œ 107ê°• ëª¨ë‹¬ â•â•â• */}
      {showOnlineCourse && (<div className="fixed inset-0 bg-black/50 z-50 flex items-end justify-center"><div className="bg-white w-full max-w-lg rounded-t-2xl max-h-[90vh] overflow-y-auto">
        <div className="sticky top-0 bg-gradient-to-r from-cyan-500 to-teal-500 p-4 rounded-t-2xl flex items-center"><button onClick={() => setShowOnlineCourse(false)} className="text-white text-xl mr-3">â†</button><div><h2 className="text-white text-lg font-bold">ğŸ“ ì˜¨ë¼ì¸ê°•ì¢Œ 107ê°•</h2><p className="text-cyan-100 text-xs">ê¸ˆìœµì§‘ì§“ê¸°Â® ì™„ì „ì •ë³µ ê³¼ì •</p></div></div>
        <div className="p-4"><div className="bg-gradient-to-br from-cyan-50 to-teal-50 border border-cyan-200 rounded-xl p-5 mb-4"><div className="flex items-center gap-3 mb-3"><div className="w-12 h-12 bg-gradient-to-br from-cyan-400 to-teal-500 rounded-xl flex items-center justify-center text-white text-xl shadow-md">ğŸ“</div><div><p className="text-sm font-bold text-gray-800">ê¸ˆìœµì§‘ì§“ê¸°Â® ì™„ì „ì •ë³µ</p><p className="text-xs text-gray-500">107ê°œ ê°•ì˜ Â· ì´ 50ì‹œê°„+ Â· ë¬´ì œí•œ ë°˜ë³µ ìˆ˜ê°•</p></div></div><p className="text-xs text-gray-600 leading-relaxed">ì¬ë¬´ì„¤ê³„ì˜ A~Zë¥¼ ì²´ê³„ì ìœ¼ë¡œ ë°°ìš°ëŠ” ì˜¨ë¼ì¸ ê°•ì¢Œì…ë‹ˆë‹¤. ë¶€ì±„ê´€ë¦¬ë¶€í„° íˆ¬ì, ì€í‡´ì„¤ê³„ê¹Œì§€ ê¸ˆìœµì§‘ì§“ê¸°Â® ë°©ë²•ë¡ ì˜ ëª¨ë“  ê²ƒì„ ë‹´ì•˜ìŠµë‹ˆë‹¤.</p></div>
          <div className="space-y-3"><button onClick={() => window.open('https://link.payple.kr/NzcxOjc2ODQ3NzY2NjM3Mjg2', '_blank')} className="w-full p-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl text-left hover:shadow-lg transition"><p className="text-sm font-bold">ğŸ“š ì˜¨ë¼ì¸ê°•ì¢Œë§Œ (107ê°•)</p><p className="text-xl font-extrabold">â‚©290,000</p><p className="text-xs opacity-80">107ê°œ ê°•ì˜ ë¬´ì œí•œ ìˆ˜ê°•</p></button><button onClick={() => window.open('https://link.payple.kr/NzcxOjc2ODQ3NzY4Mzc5MTUx', '_blank')} className="w-full p-4 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-xl text-left hover:shadow-lg transition relative"><span className="absolute -top-2 right-4 bg-red-500 text-white text-xs font-bold px-2 py-0.5 rounded-full">ì¶”ì²œ</span><p className="text-sm font-bold">ğŸ“š+ğŸ“– ê°•ì¢Œ + ì „ìì±… ì„¸íŠ¸</p><p className="text-xl font-extrabold">â‚©300,000</p><p className="text-xs opacity-80">107ê°• + ê¸ˆìœµì§‘ì§“ê¸°Â® ì „ìì±… (â‚©12,900 ìƒë‹¹)</p></button><button onClick={() => window.open('https://link.payple.kr/NzcxOjc2ODQ3NzcwMjQ2MzQw', '_blank')} className="w-full p-4 bg-gradient-to-r from-amber-500 to-amber-600 text-white rounded-xl text-left hover:shadow-lg transition"><p className="text-sm font-bold">ğŸ“š+ğŸ“–+ğŸ“ ì˜¬ì¸ì› íŒ¨í‚¤ì§€</p><p className="text-xl font-extrabold">â‚©590,000</p><p className="text-xs opacity-80">107ê°• + ì „ìì±… + ì›”ë¡€ ZOOM ì„¸ë¯¸ë‚˜ 1ë…„</p></button></div>
        </div>
      </div></div>)}

      {/* â•â•â• ì „ìì±… ëª¨ë‹¬ â•â•â• */}
      {showEbook && (<div className="fixed inset-0 bg-black/50 z-50 flex items-end justify-center"><div className="bg-white w-full max-w-lg rounded-t-2xl max-h-[90vh] overflow-y-auto">
        <div className="sticky top-0 bg-gradient-to-r from-orange-500 to-orange-600 p-4 rounded-t-2xl flex items-center"><button onClick={() => setShowEbook(false)} className="text-white text-xl mr-3">â†</button><div><h2 className="text-white text-lg font-bold">ğŸ“– ê¸ˆìœµì§‘ì§“ê¸°Â® ì „ìì±…</h2><p className="text-orange-100 text-xs">ì˜¤ìƒì—´ CFPì˜ ì¬ë¬´ì„¤ê³„ ê°€ì´ë“œ</p></div></div>
        <div className="p-4"><div className="flex gap-4 mb-4"><img src={EBOOK_COVER_URL} alt="ì „ìì±… í‘œì§€" className="w-28 h-40 object-cover rounded-xl shadow-md" /><div className="flex-1"><p className="text-lg font-bold text-gray-800 mb-1">ê¸ˆìœµì§‘ì§“ê¸°Â®</p><p className="text-sm text-gray-500 mb-2">ì˜¤ìƒì—´ CFP ì €</p><p className="text-xs text-gray-600 leading-relaxed">20ë…„ ê²½ë ¥ ì¬ë¬´ì„¤ê³„ ì „ë¬¸ê°€ì˜ ë…¸í•˜ìš°ë¥¼ ë‹´ì€ ê¸ˆìœµì§‘ì§“ê¸°Â® ì „ìì±…ì…ë‹ˆë‹¤. ë¶€ì±„ê´€ë¦¬ë¶€í„° íˆ¬ì, ì€í‡´ì„¤ê³„ê¹Œì§€ ì²´ê³„ì ì¸ ì¬ë¬´ì„¤ê³„ ë°©ë²•ë¡ ì„ ì†Œê°œí•©ë‹ˆë‹¤.</p></div></div>
          <button onClick={() => window.open('https://link.payple.kr/NzcxOjc2ODQ3NzcxMjU1NTMw', '_blank')} className="w-full py-3 bg-gradient-to-r from-orange-500 to-orange-600 text-white font-bold rounded-xl hover:shadow-lg transition">â‚©12,900 êµ¬ë§¤í•˜ê¸°</button>
        </div>
      </div></div>)}

      {/* â•â•â• ê³µìœ  ëª¨ë‹¬ â•â•â• */}
      {showShare && (<div className="fixed inset-0 bg-black/50 z-50 flex items-end justify-center"><div className="bg-white w-full max-w-lg rounded-t-2xl max-h-[90vh] overflow-y-auto">
        <div className="sticky top-0 bg-gradient-to-r from-violet-500 to-violet-600 p-4 rounded-t-2xl flex items-center"><button onClick={() => setShowShare(false)} className="text-white text-xl mr-3">â†</button><div><h2 className="text-white text-lg font-bold">ğŸ”— ì¹œêµ¬ì—ê²Œ ê³µìœ í•˜ê¸°</h2><p className="text-violet-100 text-xs">AIë¨¸ë‹ˆì•¼ë¥¼ ì¹œêµ¬ì—ê²Œ ì•Œë ¤ì£¼ì„¸ìš”</p></div></div>
        <div className="p-4"><div className="bg-violet-50 border border-violet-200 rounded-xl p-4 mb-4 text-center"><p className="text-sm text-gray-600 mb-2">ê³µìœ  ë§í¬</p><p className="text-sm font-mono text-violet-600 bg-white px-3 py-2 rounded-lg border">{SHARE_URL}</p></div>
          <div className="grid grid-cols-2 gap-3"><button onClick={() => handleShare('copy')} className="flex items-center gap-2 p-3 bg-gray-100 rounded-xl hover:bg-gray-200 transition"><span>ğŸ“‹</span><span className="text-sm font-semibold text-gray-700">ë§í¬ ë³µì‚¬</span></button><button onClick={() => handleShare('kakao')} className="flex items-center gap-2 p-3 bg-yellow-50 rounded-xl hover:bg-yellow-100 transition"><span>ğŸ’¬</span><span className="text-sm font-semibold text-gray-700">ì¹´ì¹´ì˜¤í†¡</span></button><button onClick={() => handleShare('sms')} className="flex items-center gap-2 p-3 bg-green-50 rounded-xl hover:bg-green-100 transition"><span>ğŸ“±</span><span className="text-sm font-semibold text-gray-700">ë¬¸ì ì „ì†¡</span></button><button onClick={() => handleShare('email')} className="flex items-center gap-2 p-3 bg-blue-50 rounded-xl hover:bg-blue-100 transition"><span>ğŸ“§</span><span className="text-sm font-semibold text-gray-700">ì´ë©”ì¼</span></button></div>
          <button onClick={() => handleShare('native')} className="w-full mt-3 py-3 bg-violet-500 text-white font-bold rounded-xl hover:bg-violet-600 transition">ğŸ“¤ ë‹¤ë¥¸ ì•±ìœ¼ë¡œ ê³µìœ </button>
        </div>
      </div></div>)}

      {/* â•â•â• ì„¤ì • ëª¨ë‹¬ â•â•â• */}
      {showSettings && (<div className="fixed inset-0 bg-black/50 z-50 flex items-end justify-center"><div className="bg-white w-full max-w-lg rounded-t-2xl max-h-[90vh] overflow-y-auto">
        <div className="sticky top-0 bg-white border-b p-4 rounded-t-2xl flex items-center"><button onClick={() => setShowSettings(false)} className="text-gray-500 text-xl mr-3">â†</button><h2 className="text-lg font-bold text-gray-800">âš™ï¸ ì„¤ì •</h2></div>
        <div className="p-4 space-y-4">
          <div><h3 className="text-xs font-bold text-gray-400 uppercase mb-2">ğŸ”” ì•Œë¦¼</h3><div className="bg-white rounded-xl border border-gray-200 divide-y"><div className="flex items-center justify-between px-4 py-3"><span className="text-sm text-gray-700">í‘¸ì‹œ ì•Œë¦¼</span><button onClick={() => { setSettingNotification(!settingNotification); localStorage.setItem('moneya_setting_notification', String(!settingNotification)); }} className={`w-11 h-6 rounded-full transition ${settingNotification ? 'bg-blue-500' : 'bg-gray-300'}`}><div className={`w-5 h-5 bg-white rounded-full shadow transition-transform ${settingNotification ? 'translate-x-5' : 'translate-x-0.5'}`} /></button></div><div className="flex items-center justify-between px-4 py-3"><span className="text-sm text-gray-700">ë§¤ì¼ ì§€ì¶œ ë¦¬ë§ˆì¸ë”</span><button onClick={() => { setSettingDailyReminder(!settingDailyReminder); localStorage.setItem('moneya_setting_dailyReminder', String(!settingDailyReminder)); }} className={`w-11 h-6 rounded-full transition ${settingDailyReminder ? 'bg-blue-500' : 'bg-gray-300'}`}><div className={`w-5 h-5 bg-white rounded-full shadow transition-transform ${settingDailyReminder ? 'translate-x-5' : 'translate-x-0.5'}`} /></button></div><div className="flex items-center justify-between px-4 py-3"><span className="text-sm text-gray-700">íš¨ê³¼ìŒ</span><button onClick={() => { setSettingSound(!settingSound); localStorage.setItem('moneya_setting_sound', String(!settingSound)); }} className={`w-11 h-6 rounded-full transition ${settingSound ? 'bg-blue-500' : 'bg-gray-300'}`}><div className={`w-5 h-5 bg-white rounded-full shadow transition-transform ${settingSound ? 'translate-x-5' : 'translate-x-0.5'}`} /></button></div></div></div>
          <div><h3 className="text-xs font-bold text-gray-400 uppercase mb-2">ğŸ–¥ï¸ í™”ë©´</h3><div className="bg-white rounded-xl border border-gray-200"><div className="flex items-center justify-between px-4 py-3"><span className="text-sm text-gray-700">ê¸ˆì•¡ ë‹¨ìœ„</span><div className="flex bg-gray-100 rounded-lg p-0.5"><button onClick={() => { setSettingAmountUnit('ë§Œì›'); localStorage.setItem('moneya_setting_amountUnit', 'ë§Œì›'); }} className={`px-3 py-1 text-xs rounded-md transition ${settingAmountUnit === 'ë§Œì›' ? 'bg-white text-blue-600 shadow-sm font-bold' : 'text-gray-400'}`}>ë§Œì›</button><button onClick={() => { setSettingAmountUnit('ì›'); localStorage.setItem('moneya_setting_amountUnit', 'ì›'); }} className={`px-3 py-1 text-xs rounded-md transition ${settingAmountUnit === 'ì›' ? 'bg-white text-blue-600 shadow-sm font-bold' : 'text-gray-400'}`}>ì›</button></div></div></div></div>
          <div><h3 className="text-xs font-bold text-gray-400 uppercase mb-2">ğŸ”’ ë³´ì•ˆ</h3><div className="bg-white rounded-xl border border-gray-200"><div className="flex items-center justify-between px-4 py-3"><span className="text-sm text-gray-700">ìƒì²´ ì¸ì¦</span><button onClick={() => { setSettingBioAuth(!settingBioAuth); localStorage.setItem('moneya_setting_bioAuth', String(!settingBioAuth)); }} className={`w-11 h-6 rounded-full transition ${settingBioAuth ? 'bg-blue-500' : 'bg-gray-300'}`}><div className={`w-5 h-5 bg-white rounded-full shadow transition-transform ${settingBioAuth ? 'translate-x-5' : 'translate-x-0.5'}`} /></button></div></div></div>
          <div><h3 className="text-xs font-bold text-gray-400 uppercase mb-2">ğŸ’¾ ë°ì´í„° ê´€ë¦¬</h3><div className="bg-white rounded-xl border border-gray-200"><button onClick={() => { localStorage.removeItem('financialHouseData_cache'); setShowCacheClearDone(true); setTimeout(() => setShowCacheClearDone(false), 2000); }} className="w-full flex items-center justify-between px-4 py-3 text-left"><span className="text-sm text-gray-700">ìºì‹œ ì‚­ì œ</span>{showCacheClearDone ? <span className="text-xs text-green-500 font-bold">âœ… ì™„ë£Œ</span> : <span className="text-gray-400 text-sm">â€º</span>}</button></div></div>
          <div><h3 className="text-xs font-bold text-gray-400 uppercase mb-2">â„¹ï¸ ì•± ì •ë³´</h3><div className="bg-white rounded-xl border border-gray-200 divide-y"><div className="flex items-center justify-between px-4 py-3"><span className="text-sm text-gray-700">ë²„ì „</span><span className="text-sm text-gray-400">v2.8.1</span></div><div className="flex items-center justify-between px-4 py-3"><span className="text-sm text-gray-700">ê°œë°œ</span><span className="text-sm text-gray-400">ì˜¤ì›íŠ¸ê¸ˆìœµì—°êµ¬ì†Œ</span></div></div></div>
        </div>
      </div></div>)}

      {/* â•â•â• FAQ ëª¨ë‹¬ â•â•â• */}
      {showFAQ && (<div className="fixed inset-0 bg-black/50 z-50 flex items-end justify-center"><div className="bg-white w-full max-w-lg rounded-t-2xl max-h-[90vh] overflow-y-auto">
        <div className="sticky top-0 bg-white border-b p-4 rounded-t-2xl flex items-center"><button onClick={() => setShowFAQ(false)} className="text-gray-500 text-xl mr-3">â†</button><h2 className="text-lg font-bold text-gray-800">â“ ê³ ê°ì„¼í„° / FAQ</h2></div>
        <div className="p-4 space-y-2">{FAQ_DATA.map((item, idx) => (<div key={idx} className="border border-gray-200 rounded-xl overflow-hidden"><button onClick={() => setOpenFaqIndex(openFaqIndex === idx ? null : idx)} className="w-full flex items-center justify-between px-4 py-3 text-left hover:bg-gray-50"><span className="text-sm font-semibold text-gray-700 flex-1">{item.q}</span><span className="text-gray-400">{openFaqIndex === idx ? 'â–²' : 'â–¼'}</span></button>{openFaqIndex === idx && (<div className="px-4 pb-3 text-sm text-gray-600 bg-gray-50">{item.a}</div>)}</div>))}</div>
      </div></div>)}

      {/* â•â•â• ì´ìš©ì•½ê´€ ëª¨ë‹¬ â•â•â• */}
      {showTerms && (<div className="fixed inset-0 bg-black/50 z-50 flex items-end justify-center"><div className="bg-white w-full max-w-lg rounded-t-2xl max-h-[90vh] overflow-y-auto">
        <div className="sticky top-0 bg-white border-b p-4 rounded-t-2xl flex items-center"><button onClick={() => setShowTerms(false)} className="text-gray-500 text-xl mr-3">â†</button><h2 className="text-lg font-bold text-gray-800">ğŸ“„ ì´ìš©ì•½ê´€</h2></div>
        <div className="p-4 text-sm text-gray-600 space-y-4 leading-relaxed"><h3 className="font-bold text-gray-800">ì œ1ì¡° (ëª©ì )</h3><p>ì´ ì•½ê´€ì€ ì˜¤ì›íŠ¸ê¸ˆìœµì—°êµ¬ì†Œ(ì´í•˜ "íšŒì‚¬")ê°€ ì œê³µí•˜ëŠ” AIë¨¸ë‹ˆì•¼ ì„œë¹„ìŠ¤(ì´í•˜ "ì„œë¹„ìŠ¤")ì˜ ì´ìš© ì¡°ê±´ ë° ì ˆì°¨ì— ê´€í•œ ì‚¬í•­ì„ ê·œì •í•¨ì„ ëª©ì ìœ¼ë¡œ í•©ë‹ˆë‹¤.</p><h3 className="font-bold text-gray-800">ì œ2ì¡° (ì •ì˜)</h3><p>"ì„œë¹„ìŠ¤"ë€ íšŒì‚¬ê°€ ì œê³µí•˜ëŠ” AI ê¸°ë°˜ ì¬ë¬´ê´€ë¦¬ ë° ê¸ˆìœµì§‘ì§“ê¸°Â® ê´€ë ¨ ì¼ì²´ì˜ ì„œë¹„ìŠ¤ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.</p><h3 className="font-bold text-gray-800">ì œ3ì¡° (ì•½ê´€ì˜ íš¨ë ¥)</h3><p>ë³¸ ì•½ê´€ì€ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ê³ ì í•˜ëŠ” ëª¨ë“  ì´ìš©ìì— ëŒ€í•˜ì—¬ ê·¸ íš¨ë ¥ì´ ë°œìƒí•©ë‹ˆë‹¤.</p></div>
      </div></div>)}

      {/* â•â•â• ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ ëª¨ë‹¬ â•â•â• */}
      {showPrivacy && (<div className="fixed inset-0 bg-black/50 z-50 flex items-end justify-center"><div className="bg-white w-full max-w-lg rounded-t-2xl max-h-[90vh] overflow-y-auto">
        <div className="sticky top-0 bg-white border-b p-4 rounded-t-2xl flex items-center"><button onClick={() => setShowPrivacy(false)} className="text-gray-500 text-xl mr-3">â†</button><h2 className="text-lg font-bold text-gray-800">ğŸ”’ ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</h2></div>
        <div className="p-4 text-sm text-gray-600 space-y-4 leading-relaxed"><h3 className="font-bold text-gray-800">1. ìˆ˜ì§‘í•˜ëŠ” ê°œì¸ì •ë³´</h3><p>íšŒì‚¬ëŠ” ì„œë¹„ìŠ¤ ì œê³µì„ ìœ„í•´ ì´ë©”ì¼, ì´ë¦„, ì¬ë¬´ì •ë³´(ì†Œë“, ìì‚°, ë¶€ì±„) ë“±ì„ ìˆ˜ì§‘í•©ë‹ˆë‹¤.</p><h3 className="font-bold text-gray-800">2. ê°œì¸ì •ë³´ì˜ ì´ìš©ëª©ì </h3><p>ìˆ˜ì§‘ëœ ê°œì¸ì •ë³´ëŠ” ë§ì¶¤í˜• ì¬ë¬´ì„¤ê³„ ì„œë¹„ìŠ¤ ì œê³µ, ì„œë¹„ìŠ¤ ê°œì„  ë“±ì— í™œìš©ë©ë‹ˆë‹¤.</p><h3 className="font-bold text-gray-800">3. ê°œì¸ì •ë³´ì˜ ë³´ê´€</h3><p>íšŒì› íƒˆí‡´ ì‹œ ëª¨ë“  ê°œì¸ì •ë³´ëŠ” ì¦‰ì‹œ íŒŒê¸°ë©ë‹ˆë‹¤.</p></div>
      </div></div>)}

      {/* â•â•â• íšŒì›íƒˆí‡´ ëª¨ë‹¬ â•â•â• */}
      {showWithdraw && (<div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4"><div className="bg-white rounded-2xl max-w-sm w-full p-6 text-center"><p className="text-4xl mb-3">âš ï¸</p><h3 className="text-lg font-bold text-gray-800 mb-2">íšŒì› íƒˆí‡´</h3><p className="text-sm text-gray-600 mb-1">íƒˆí‡´ ì‹œ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.</p><p className="text-sm text-red-500 font-semibold mb-4">ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p><div className="flex gap-3"><button onClick={() => setShowWithdraw(false)} className="flex-1 py-2.5 bg-gray-100 text-gray-600 rounded-lg font-semibold">ì·¨ì†Œ</button><button onClick={() => { setShowWithdraw(false); onLogout(); }} className="flex-1 py-2.5 bg-red-500 text-white rounded-lg font-semibold">íƒˆí‡´</button></div></div></div>)}

      {/* â•â•â• ì´ˆê¸°í™” í™•ì¸ ëª¨ë‹¬ â•â•â• */}
      {showResetConfirm && (<div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4"><div className="bg-white rounded-2xl max-w-sm w-full p-6 text-center"><p className="text-4xl mb-3">âš ï¸</p><h3 className="text-lg font-bold text-gray-800 mb-2">ì²˜ìŒë¶€í„° ë‹¤ì‹œí•˜ê¸°</h3><p className="text-sm text-gray-600 mb-4">ëª¨ë“  ì¬ë¬´ì„¤ê³„ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.<br />ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p><div className="flex gap-3"><button onClick={() => setShowResetConfirm(false)} className="flex-1 py-2.5 bg-gray-100 text-gray-600 rounded-lg font-semibold">ì·¨ì†Œ</button><button onClick={handleResetConfirm} className="flex-1 py-2.5 bg-red-500 text-white rounded-lg font-semibold">ì´ˆê¸°í™”</button></div></div></div>)}

      {/* â•â•â• í”„ë¡œí•„ í¸ì§‘ ëª¨ë‹¬ â•â•â• */}
      {showProfileEdit && (<div className="fixed inset-0 bg-black/50 z-50 flex items-end justify-center"><div className="bg-white w-full max-w-lg rounded-t-2xl max-h-[90vh] overflow-y-auto">
        <div className="sticky top-0 bg-white border-b p-4 rounded-t-2xl flex items-center"><button onClick={() => setShowProfileEdit(false)} className="text-gray-500 text-xl mr-3">â†</button><h2 className="text-lg font-bold text-gray-800">í”„ë¡œí•„ í¸ì§‘</h2></div>
        <div className="p-4 space-y-4"><div><label className="block text-xs font-semibold text-gray-700 mb-1">ì´ë¦„</label><input type="text" value={editName} onChange={e => setEditName(e.target.value)} className="w-full px-3 py-2.5 border border-gray-200 rounded-lg text-sm" /></div><button onClick={() => setShowProfileEdit(false)} className="w-full py-3 bg-blue-500 text-white font-bold rounded-xl">ì €ì¥</button></div>
      </div></div>)}

      {/* â•â•â• ì „ë¬¸ê°€ ê°•ì˜Â·ìƒë‹´ ëª¨ë‹¬ â•â•â• */}
      {showExpertConsult && (<div className="fixed inset-0 bg-black/50 z-50 flex items-end justify-center"><div className="bg-white w-full max-w-lg rounded-t-2xl max-h-[90vh] overflow-y-auto">
        <div className="sticky top-0 bg-gradient-to-r from-amber-500 to-amber-600 p-4 rounded-t-2xl flex items-center z-10"><button onClick={closeExpertConsultModal} className="text-white text-xl mr-3">â†</button><div className="flex-1"><h2 className="text-white text-lg font-bold">ğŸ‘¨â€ğŸ« ì˜¤ìƒì—´ ëŒ€í‘œ ê°•ì˜Â·ìƒë‹´</h2><p className="text-amber-100 text-xs">20ë…„ ê²½ë ¥ ì¬ë¬´ì„¤ê³„ ì „ë¬¸ê°€</p></div></div>
        {consultView === 'list' && (<div className="p-4 space-y-3">
          <div className="bg-amber-50 border border-amber-200 rounded-xl p-4 flex items-center gap-3 mb-2"><img src={PROFILE_IMAGE_URL} alt="ì˜¤ìƒì—´ CFP" className="w-12 h-12 rounded-full object-cover border-2 border-amber-300" /><div><p className="text-sm font-bold text-amber-800">ì˜¤ìƒì—´ CFP</p><p className="text-xs text-amber-600">ì˜¤ì›íŠ¸ê¸ˆìœµì—°êµ¬ì†Œ ëŒ€í‘œ</p><p className="text-xs text-gray-500 mt-0.5">500íšŒ+ ê°•ì˜ Â· 2000ê±´+ ìƒë‹´</p></div></div>
          <p className="text-xs text-gray-500 font-bold">ğŸ“š ê°•ì˜</p>
          {CONSULT_TYPES.filter(t => t.category === 'lecture').map(type => (<button key={type.id} onClick={() => handleConsultSelectType(type)} className="w-full flex items-center gap-3 p-4 bg-white border border-gray-200 rounded-xl hover:border-amber-300 hover:shadow-sm transition text-left"><span className="text-2xl">{type.icon}</span><div className="flex-1"><p className="text-sm font-bold text-gray-800">{type.title}</p><p className="text-xs text-gray-500">{type.desc}</p><p className="text-xs text-gray-400 mt-0.5">{type.detail}</p></div><div className="text-right"><p className="text-sm font-bold text-amber-600">{type.priceLabel}</p>{'priceSub' in type && <p className="text-xs text-gray-400">{type.priceSub}</p>}</div></button>))}
          <p className="text-xs text-gray-500 font-bold mt-2">ğŸ’¼ 1:1 ìƒë‹´</p>
          {CONSULT_TYPES.filter(t => t.category === 'consultation').map(type => (<button key={type.id} onClick={() => handleConsultSelectType(type)} className={`w-full flex items-center gap-3 p-4 bg-white border rounded-xl hover:shadow-sm transition text-left ${'premium' in type ? 'border-amber-300 bg-amber-50/30' : 'border-gray-200 hover:border-amber-300'}`}><span className="text-2xl">{type.icon}</span><div className="flex-1"><p className="text-sm font-bold text-gray-800">{type.title}</p><p className="text-xs text-gray-500">{type.desc}</p><p className="text-xs text-gray-400 mt-0.5">{type.detail}</p></div><div className="text-right"><p className="text-sm font-bold text-amber-600">{type.priceLabel}</p><p className="text-xs text-gray-400">{type.sessions}íšŒ</p></div></button>))}
          {consultBookings.length > 0 && (<div className="mt-4 pt-3 border-t border-gray-200"><p className="text-xs text-gray-500 font-bold mb-2">ğŸ“‹ ì‹ ì²­ ë‚´ì—­</p>{consultBookings.map(b => (<div key={b.id} className="text-xs text-gray-600 bg-gray-50 rounded-lg p-2 mb-1">{b.type.title} {b.month ? `Â· ${CONSULT_YEAR}ë…„ ${b.month}ì›”` : ''}</div>))}</div>)}
        </div>)}
        {consultView === 'schedule' && consultScheduleData && (<div className="p-4"><button onClick={handleConsultGoBack} className="text-sm text-gray-500 mb-3">â† ë’¤ë¡œ</button><h3 className="text-sm font-bold text-gray-800 mb-3">ğŸ“… {consultSelectedType?.title} ì¼ì • ({CONSULT_YEAR})</h3>
          <div className="space-y-2">{consultAvailableMonths.map(m => { const isPast = isConsultMonthPast(m); const isSelected = consultSelectedMonth === m; const dates = consultScheduleData.months[m]; return (<div key={m}><button onClick={() => handleConsultSelectMonth(m)} className={`w-full flex items-center justify-between p-3 rounded-xl border-2 transition ${isPast ? 'border-gray-100 bg-gray-50 opacity-50' : isSelected ? 'border-amber-400 bg-amber-50' : 'border-gray-200 hover:border-amber-300'}`} disabled={isPast}><span className={`text-sm font-bold ${isPast ? 'text-gray-400' : 'text-gray-800'}`}>{m}ì›”</span><span className="text-xs text-gray-500">{dates.length}íšŒ</span></button>{isSelected && (<div className="mt-1 ml-4 space-y-1">{dates.map(d => (<div key={d} className="text-xs text-gray-600 py-1">ğŸ“Œ {m}/{d} ({getConsultDow(CONSULT_YEAR, m, d)})</div>))}<button onClick={() => { setConsultView('confirm'); }} className="mt-2 w-full py-2.5 bg-amber-500 text-white text-sm font-bold rounded-lg">ì´ ì¼ì •ìœ¼ë¡œ ì‹ ì²­</button></div>)}</div>); })}</div>
        </div>)}
        {consultView === 'confirm' && consultSelectedType && (<div className="p-4"><button onClick={handleConsultGoBack} className="text-sm text-gray-500 mb-3">â† ë’¤ë¡œ</button><div className="bg-amber-50 border border-amber-200 rounded-xl p-4 mb-4"><p className="text-sm font-bold text-amber-800">{consultSelectedType.icon} {consultSelectedType.title}</p>{consultSelectedMonth && <p className="text-xs text-amber-600">{CONSULT_YEAR}ë…„ {consultSelectedMonth}ì›”</p>}<p className="text-2xl font-extrabold text-amber-700 mt-2">â‚©{consultSelectedType.price.toLocaleString()}</p></div><button onClick={handleConsultPayment} className="w-full py-3 bg-amber-500 text-white font-bold rounded-xl hover:bg-amber-600 transition">ğŸ’³ ê²°ì œí•˜ê¸° (í˜ì´í”Œ)</button><p className="text-xs text-gray-400 text-center mt-2">ì•ˆì „í•œ ê²°ì œë¥¼ ìœ„í•´ í˜ì´í”Œ ê²°ì œ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤</p></div>)}
        {consultToast && (<div className="fixed bottom-20 left-1/2 -translate-x-1/2 bg-gray-800 text-white text-sm px-4 py-2 rounded-full shadow-lg z-[60] animate-bounce">{consultToast}</div>)}
      </div></div>)}

      {/* â•â•â• PIN ì„¤ì • í™”ë©´ â•â•â• */}
      {showPinSetup && userId && (
        <PinSetupScreen
          mode={pinMode}
          userId={userId}
          onClose={() => setShowPinSetup(false)}
          onComplete={(enabled: boolean) => {
            setPinEnabledState(enabled);
            setShowPinSetup(false);
          }}
        />
      )}

    </div>
  );
}
